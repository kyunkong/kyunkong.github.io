<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <!-- <link rel="icon" href="/favicon.ico" type="image/x-icon"> -->
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>Oracle Useful Scripts - Fung's wiki</title>
    <!-- <meta name="keywords" content=""/> -->
    <!-- <meta name="description" content=""/> -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/">Fung's wiki</a>
    &nbsp;&#187;&nbsp;
    <a href="/#scripts">scripts</a>
    &nbsp;&#187;&nbsp;Oracle Useful Scripts
    <span class="updated">Last Update: &nbsp;
    2018-01-15 12:11:25
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#showlockssql-show-all-the-lock-information">showlocks.sql show all the lock information</a></li>
<li><a href="#showalllockssql-show-all-locks-information">showalllocks.sql show all locks information</a></li>
<li><a href="#my_sess_eventsql-show-current-session-status">my_sess_event.sql-show current session status</a></li>
<li><a href="#show_paramsql-show-parameter-including-un-documented-parameters">show_param.sql-show parameter including un-documented parameters</a></li>
<li><a href="#system_eventsql-show-the-entire-system-waiting-status">system_event.sql, show the entire system waiting status</a></li>
<li><a href="#sesstatsql-show-current-session-vsesstat">sesstat.sql-show current session v$sesstat</a></li>
<li><a href="#undosizesql-get-the-current-undo-information">undosize.sql, get the current undo information</a></li>
<li><a href="#show_cursor_numsql-finding-the-max-cursor-number">show_cursor_num.sql- finding the max cursor number</a></li>
<li><a href="#log_frequencysql-finding-the-log-switch-frequency">log_frequency.sql- finding the log switch frequency</a></li>
<li><a href="#lfsdiagsql-diagnose-log-file-sync">lfsdiag.sql- Diagnose log file sync</a></li>
<li><a href="#gloginsql">glogin.sql</a></li>
<li><a href="#show_spacesql-by-tom-kyte">show_space.sql by Tom Kyte</a></li>
<li><a href="#print_tablesql-by-tom-kyte">print_table.sql by Tom Kyte</a></li>
<li><a href="#show_spacesql-by-tom-kyte_1">show_space.sql by Tom Kyte</a></li>
<li><a href="#waitprofsql-">waitprof.sql-按等待事件频率分组</a><ul>
<li><a href="#dba_function-script">dba_function script</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="showlockssql-show-all-the-lock-information">showlocks.sql show all the lock information</h1>
<div class="hlcode"><pre><span class="o">--</span> <span class="n">name</span><span class="o">:</span> <span class="n">showlock</span><span class="p">.</span><span class="n">sql</span>
<span class="n">column</span> <span class="n">o_name</span> <span class="n">format</span> <span class="n">a10</span>
<span class="n">column</span> <span class="n">lock_type</span> <span class="n">format</span> <span class="n">a20</span>
<span class="n">column</span> <span class="n">object_name</span> <span class="n">format</span> <span class="n">a15</span>
<span class="n">select</span> <span class="n">rpad</span><span class="p">(</span><span class="n">oracle_username</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="n">o_name</span><span class="p">,</span><span class="n">session_id</span> <span class="n">sid</span><span class="p">,</span>
<span class="n">decode</span><span class="p">(</span><span class="n">locked_mode</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="err">&#39;</span><span class="n">None</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Null</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Row</span> <span class="n">share</span><span class="err">&#39;</span><span class="p">,</span>
<span class="mi">3</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Row</span> <span class="n">Exclusive</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Share</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Share</span> <span class="n">Row</span> <span class="n">Exclusive</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Exclusive</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">lock_type</span><span class="p">,</span>
<span class="n">object_name</span> <span class="p">,</span><span class="n">xidusn</span><span class="p">,</span><span class="n">xidslot</span><span class="p">,</span><span class="n">xidsqn</span>
<span class="n">from</span> <span class="n">v</span><span class="err">$</span><span class="n">locked_object</span><span class="p">,</span><span class="n">all_objects</span>
<span class="n">where</span> <span class="n">v</span><span class="err">$</span><span class="n">locked_object</span><span class="p">.</span><span class="n">object_id</span><span class="o">=</span><span class="n">all_objects</span><span class="p">.</span><span class="n">object_id</span><span class="p">;</span>
</pre></div>


<h1 id="showalllockssql-show-all-locks-information">showalllocks.sql show all locks information</h1>
<div class="hlcode"><pre><span class="n">select</span> <span class="n">sid</span><span class="p">,</span><span class="n">type</span><span class="p">,</span><span class="n">id1</span><span class="p">,</span><span class="n">id2</span><span class="p">,</span>
<span class="n">decode</span><span class="p">(</span><span class="n">lmode</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="err">&#39;</span><span class="n">None</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Null</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Row</span> <span class="n">share</span><span class="err">&#39;</span><span class="p">,</span>
<span class="mi">3</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Row</span> <span class="n">Exclusive</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Share</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Share</span> <span class="n">Row</span> <span class="n">Exclusive</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Exclusive</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">lock_type</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">ctime</span><span class="p">,</span><span class="n">block</span>
<span class="n">from</span> <span class="n">v</span><span class="err">$</span><span class="n">lock</span>
<span class="n">where</span> <span class="n">TYPE</span> <span class="n">IN</span><span class="p">(</span><span class="err">&#39;</span><span class="n">TX</span><span class="sc">&#39;,&#39;</span><span class="n">TM</span><span class="err">&#39;</span><span class="p">);</span>
</pre></div>


<h1 id="my_sess_eventsql-show-current-session-status">my_sess_event.sql-show current session status</h1>
<div class="hlcode"><pre><span class="k">select</span> <span class="n">event</span><span class="p">,</span> <span class="n">total_waits</span><span class="p">,</span> <span class="n">time_waited</span>
<span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">session_event</span>
<span class="k">where</span> <span class="n">sid</span><span class="o">=</span><span class="p">(</span><span class="k">select</span> <span class="n">sid</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">mystat</span> <span class="k">where</span> <span class="n">rownum</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">order</span> <span class="k">by</span> <span class="mi">3</span> <span class="k">desc</span><span class="p">;</span>
</pre></div>


<h1 id="show_paramsql-show-parameter-including-un-documented-parameters">show_param.sql-show parameter including un-documented parameters</h1>
<div class="hlcode"><pre><span class="k">select</span> <span class="n">ksppinm</span><span class="p">,</span> <span class="n">ksppstvl</span>
<span class="k">from</span> <span class="n">x</span><span class="err">$</span><span class="n">ksppi</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="err">$</span><span class="n">ksppcv</span> <span class="n">y</span>
<span class="k">where</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">indx</span><span class="o">=</span><span class="n">y</span><span class="p">.</span><span class="n">indx</span><span class="p">)</span>
<span class="k">and</span> <span class="p">(</span><span class="k">translate</span><span class="p">(</span><span class="n">ksppinm</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="k">like</span> <span class="err">&#39;</span><span class="o">%&amp;</span><span class="mi">1</span><span class="o">%</span><span class="p">);</span>
</pre></div>


<h1 id="system_eventsql-show-the-entire-system-waiting-status">system_event.sql, show the entire system waiting status</h1>
<div class="hlcode"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span>
<span class="p">(</span><span class="k">select</span> <span class="n">event</span><span class="p">,</span> <span class="n">total_waits</span><span class="p">,</span> <span class="n">time_waited</span>
<span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">system_event</span>
<span class="k">where</span> <span class="n">wait_class</span><span class="o">&lt;&gt;</span><span class="s1">&#39;Idel&#39;</span>
<span class="k">order</span> <span class="k">by</span> <span class="mi">3</span> <span class="k">desc</span><span class="p">)</span>
<span class="k">where</span> <span class="n">rownum</span><span class="o">&lt;=</span><span class="mi">100</span><span class="p">;</span>
</pre></div>


<h1 id="sesstatsql-show-current-session-vsesstat">sesstat.sql-show current session v$sesstat</h1>
<div class="hlcode"><pre><span class="k">select</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">sesstat</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">statname</span> <span class="n">n</span>
<span class="k">where</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span> <span class="k">like</span> <span class="s1">&#39;%&amp;stat_name%&#39;</span>
<span class="k">and</span> <span class="n">s</span><span class="p">.</span><span class="n">statistic</span><span class="o">#=</span><span class="n">n</span><span class="p">.</span><span class="n">statistic</span><span class="o">#</span>
<span class="k">and</span> <span class="n">s</span><span class="p">.</span><span class="n">sid</span><span class="o">=</span><span class="p">(</span><span class="k">select</span> <span class="n">sid</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">mystat</span> <span class="k">where</span> <span class="n">rownum</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">n</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</pre></div>


<h1 id="undosizesql-get-the-current-undo-information">undosize.sql, get the current undo information</h1>
<div class="hlcode"><pre><span class="k">select</span> <span class="n">used_ublk</span><span class="p">,</span> <span class="n">used_urec</span>
<span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">transaction</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="k">session</span> <span class="n">s</span>
<span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">sid</span><span class="o">=</span><span class="p">(</span><span class="k">select</span> <span class="n">sid</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">mystat</span> <span class="k">where</span> <span class="n">rownum</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">and</span> <span class="n">s</span><span class="p">.</span><span class="n">taddr</span><span class="o">=</span><span class="n">t</span><span class="p">.</span><span class="n">addr</span><span class="p">;</span>
</pre></div>


<h1 id="show_cursor_numsql-finding-the-max-cursor-number">show_cursor_num.sql- finding the max cursor number</h1>
<div class="hlcode"><pre><span class="o">--</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">database</span> <span class="n">cursor</span> <span class="n">number</span>
<span class="o">--</span> <span class="n">Purpose</span><span class="o">:</span>   <span class="err">确定一个业务逻辑需要的</span><span class="n">Cursor</span><span class="err">数量</span>
<span class="o">--</span> <span class="n">name</span><span class="o">:</span> <span class="n">cursor_num</span><span class="p">.</span><span class="n">sql</span>
<span class="o">--</span> <span class="n">From</span><span class="o">:</span>
<span class="n">col</span> <span class="n">cumu_open_cur</span> <span class="k">for</span> <span class="mi">9999</span>
<span class="n">col</span> <span class="n">max_open_cur</span> <span class="k">for</span> <span class="n">a10</span>

<span class="n">select</span> <span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="n">as</span> <span class="n">cumu_open_cur</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">value</span> <span class="n">as</span> <span class="n">max_open_cur</span>
<span class="n">from</span> <span class="n">v</span><span class="err">$</span><span class="n">sesstat</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">statname</span> <span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">parameter</span> <span class="n">p</span>
<span class="n">where</span> <span class="n">a</span><span class="p">.</span><span class="n">statistic</span><span class="err">#</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">statistic</span><span class="err">#</span>
<span class="n">and</span> <span class="n">b</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">opened</span> <span class="n">cursors</span> <span class="n">cumulative</span><span class="err">&#39;</span>
<span class="n">and</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">open_cursors</span><span class="err">&#39;</span>
<span class="n">and</span> <span class="n">a</span><span class="p">.</span><span class="n">sid</span> <span class="o">=</span> <span class="p">(</span><span class="n">select</span> <span class="n">max</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="n">from</span> <span class="n">v</span><span class="err">$</span><span class="n">mystat</span><span class="p">)</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">p</span><span class="p">.</span><span class="n">value</span>
</pre></div>


<h1 id="log_frequencysql-finding-the-log-switch-frequency">log_frequency.sql- finding the log switch frequency</h1>
<div class="hlcode"><pre><span class="o">--</span> <span class="n">Purpose</span><span class="o">:</span> <span class="n">Showing</span> <span class="n">the</span> <span class="n">log</span> <span class="k">switch</span> <span class="n">frequency</span>
<span class="o">--</span> <span class="n">name</span><span class="o">:</span> <span class="n">log_frequency</span><span class="p">.</span><span class="n">sql</span>
<span class="o">--</span> <span class="n">from</span><span class="o">:</span>
<span class="n">COL</span> <span class="n">DAY</span> <span class="n">FORMAT</span> <span class="n">a15</span><span class="p">;</span>
<span class="n">COL</span> <span class="n">HOUR</span> <span class="n">FORMAT</span> <span class="n">a4</span><span class="p">;</span>
<span class="n">COL</span> <span class="n">TOTAL</span> <span class="n">FORMAT</span> <span class="mi">999</span><span class="p">;</span>
<span class="n">SELECT</span> <span class="n">TO_CHAR</span><span class="p">(</span><span class="n">FIRST_TIME</span><span class="p">,</span><span class="err">&#39;</span><span class="n">YYYY</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">DD</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">DAY</span><span class="p">,</span>
<span class="n">TO_CHAR</span><span class="p">(</span><span class="n">FIRST_TIME</span><span class="p">,</span><span class="err">&#39;</span><span class="n">HH24</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">HOUR</span><span class="p">,</span>
<span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">TOTAL</span>
<span class="n">FROM</span> <span class="n">V</span><span class="err">$</span><span class="n">LOG_HISTORY</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="n">TO_CHAR</span><span class="p">(</span><span class="n">FIRST_TIME</span><span class="p">,</span><span class="err">&#39;</span><span class="n">YYYY</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">DD</span><span class="err">&#39;</span><span class="p">),</span><span class="n">TO_CHAR</span><span class="p">(</span><span class="n">FIRST_TIME</span><span class="p">,</span><span class="err">&#39;</span><span class="n">HH24</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">ORDER</span> <span class="n">BY</span> <span class="n">TO_CHAR</span><span class="p">(</span><span class="n">FIRST_TIME</span><span class="p">,</span><span class="err">&#39;</span><span class="n">YYYY</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">DD</span><span class="err">&#39;</span><span class="p">),</span><span class="n">TO_CHAR</span><span class="p">(</span><span class="n">FIRST_TIME</span><span class="p">,</span><span class="err">&#39;</span><span class="n">HH24</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">ASC</span><span class="p">;</span>
</pre></div>


<h1 id="lfsdiagsql-diagnose-log-file-sync">lfsdiag.sql- Diagnose log file sync</h1>
<div class="hlcode"><pre><span class="o">--</span> <span class="n">purpose</span><span class="o">:</span> <span class="n">Debug</span> <span class="n">log</span> <span class="n">file</span> <span class="n">sync</span> <span class="n">wait</span> <span class="n">event</span>
<span class="o">--</span> <span class="n">name</span><span class="o">:</span> <span class="n">lfsdiag</span><span class="p">.</span><span class="n">sql</span>
<span class="o">--</span> <span class="n">from</span><span class="o">:</span> <span class="n">Script</span> <span class="n">to</span> <span class="n">Collect</span> <span class="n">Log</span> <span class="n">File</span> <span class="n">Sync</span> <span class="n">Diagnostic</span> <span class="n">Information</span> <span class="p">(</span><span class="n">lfsdiag</span><span class="p">.</span><span class="n">sql</span><span class="p">)</span> <span class="p">[</span><span class="n">Document</span> <span class="mf">1064487.1</span><span class="p">]</span>
<span class="n">set</span> <span class="n">echo</span> <span class="n">off</span>
<span class="n">set</span> <span class="n">feedback</span> <span class="n">off</span>
<span class="n">column</span> <span class="n">timecol</span> <span class="n">new_value</span> <span class="n">timestamp</span>
<span class="n">column</span> <span class="n">spool_extension</span> <span class="n">new_value</span> <span class="n">suffix</span>
<span class="n">select</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sysdate</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">timecol</span><span class="p">,</span>
<span class="err">&#39;</span><span class="p">.</span><span class="n">out</span><span class="err">&#39;</span> <span class="n">spool_extension</span> <span class="n">from</span> <span class="n">sys</span><span class="p">.</span><span class="n">dual</span><span class="p">;</span>
<span class="n">column</span> <span class="n">output</span> <span class="n">new_value</span> <span class="n">dbname</span>
<span class="n">select</span> <span class="n">value</span> <span class="o">||</span> <span class="sc">&#39;_&#39;</span> <span class="n">output</span>
<span class="n">from</span> <span class="n">v</span><span class="err">$</span><span class="n">parameter</span> <span class="n">where</span> <span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">db_name</span><span class="err">&#39;</span><span class="p">;</span>
<span class="n">spool</span> <span class="n">lfsdiag_</span><span class="o">&amp;&amp;</span><span class="n">dbname</span><span class="o">&amp;&amp;</span><span class="n">timestamp</span><span class="o">&amp;&amp;</span><span class="n">suffix</span>
<span class="n">set</span> <span class="n">trim</span> <span class="n">on</span>
<span class="n">set</span> <span class="n">trims</span> <span class="n">on</span>
<span class="n">set</span> <span class="n">lines</span> <span class="mi">130</span>
<span class="n">set</span> <span class="n">pages</span> <span class="mi">100</span>
<span class="n">set</span> <span class="n">verify</span> <span class="n">off</span>
<span class="n">alter</span> <span class="n">session</span> <span class="n">set</span> <span class="n">optimizer_features_enable</span> <span class="o">=</span> <span class="err">&#39;</span><span class="mf">10.2.0.4</span><span class="err">&#39;</span><span class="p">;</span>

<span class="n">PROMPT</span> <span class="n">LFSDIAG</span> <span class="n">DATA</span> <span class="n">FOR</span> <span class="o">&amp;&amp;</span><span class="n">dbname</span><span class="o">&amp;&amp;</span><span class="n">timestamp</span>
<span class="n">PROMPT</span> <span class="n">Note</span><span class="o">:</span> <span class="n">All</span> <span class="n">timings</span> <span class="n">are</span> <span class="n">in</span> <span class="n">milliseconds</span> <span class="p">(</span><span class="mi">1000</span> <span class="n">milliseconds</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">second</span><span class="p">)</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">IMPORTANT</span> <span class="n">PARAMETERS</span> <span class="n">RELATING</span> <span class="n">TO</span> <span class="n">LOG</span> <span class="kt">FILE</span> <span class="n">SYNC</span> <span class="n">WAITS</span><span class="o">:</span>
<span class="n">column</span> <span class="n">name</span> <span class="n">format</span> <span class="n">a40</span> <span class="n">wra</span>
<span class="n">column</span> <span class="n">value</span> <span class="n">format</span> <span class="n">a40</span> <span class="n">wra</span>
<span class="n">select</span> <span class="n">inst_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">parameter</span>
<span class="n">where</span> <span class="p">((</span><span class="n">value</span> <span class="n">is</span> <span class="n">not</span> <span class="n">null</span> <span class="n">and</span> <span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">log_archive</span><span class="o">%</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">or</span>
<span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">commit</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">event</span><span class="o">=%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">lgwr</span><span class="o">%</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">and</span> <span class="n">name</span> <span class="n">not</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span> <span class="n">name</span> <span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">parameter</span> <span class="n">where</span> <span class="p">(</span><span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">log_archive_dest_state</span><span class="o">%</span><span class="err">&#39;</span>
<span class="n">and</span> <span class="n">value</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">enable</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">or</span> <span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log_archive_format</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">HISTOGRAM</span> <span class="n">DATA</span> <span class="n">FOR</span> <span class="n">LFS</span> <span class="n">AND</span> <span class="n">OTHER</span> <span class="n">RELATED</span> <span class="n">WAITS</span><span class="o">:</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">APPROACH</span><span class="o">:</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">the</span> <span class="n">wait</span> <span class="n">distribution</span> <span class="k">for</span> <span class="n">log</span> <span class="n">file</span> <span class="n">sync</span> <span class="n">waits</span>
<span class="n">PROMPT</span> <span class="n">by</span> <span class="n">looking</span> <span class="n">at</span> <span class="s">&quot;wait_time_milli&quot;</span><span class="p">.</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">the</span> <span class="n">high</span> <span class="n">wait</span> <span class="n">times</span> <span class="n">then</span>
<span class="n">PROMPT</span> <span class="n">see</span> <span class="k">if</span> <span class="n">you</span> <span class="n">can</span> <span class="n">correlate</span> <span class="n">those</span> <span class="n">with</span> <span class="n">other</span> <span class="n">related</span> <span class="n">wait</span> <span class="n">events</span><span class="p">.</span>
<span class="n">column</span> <span class="n">event</span> <span class="n">format</span> <span class="n">a40</span> <span class="n">wra</span>
<span class="n">select</span> <span class="n">inst_id</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">wait_time_milli</span><span class="p">,</span> <span class="n">wait_count</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">event_histogram</span>
<span class="n">where</span> <span class="n">event</span> <span class="n">in</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="sc">&#39;,&#39;</span><span class="n">gcs</span> <span class="n">log</span> <span class="n">flush</span> <span class="n">sync</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">parallel</span> <span class="n">write</span><span class="sc">&#39;,&#39;</span><span class="n">wait</span> <span class="k">for</span> <span class="n">scn</span> <span class="n">ack</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="k">switch</span> <span class="n">completion</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">cr</span> <span class="n">grant</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">gc</span> <span class="n">buffer</span> <span class="n">busy</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">current</span> <span class="n">block</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">or</span>
<span class="n">event</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LGWR</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">event</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LNS</span><span class="o">%</span><span class="err">&#39;</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">2</span> <span class="n">desc</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">ORDERED</span> <span class="n">BY</span> <span class="n">WAIT_TIME_MILLI</span>
<span class="n">select</span> <span class="n">inst_id</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">wait_time_milli</span><span class="p">,</span> <span class="n">wait_count</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">event_histogram</span>
<span class="n">where</span> <span class="n">event</span> <span class="n">in</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="sc">&#39;,&#39;</span><span class="n">gcs</span> <span class="n">log</span> <span class="n">flush</span> <span class="n">sync</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">parallel</span> <span class="n">write</span><span class="sc">&#39;,&#39;</span><span class="n">wait</span> <span class="k">for</span> <span class="n">scn</span> <span class="n">ack</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="k">switch</span> <span class="n">completion</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">cr</span> <span class="n">grant</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">gc</span> <span class="n">buffer</span> <span class="n">busy</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">current</span> <span class="n">block</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">or</span> <span class="n">event</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LGWR</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">event</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LNS</span><span class="o">%</span><span class="err">&#39;</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="n">desc</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">REDO</span> <span class="n">WRITE</span> <span class="n">STATS</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="s">&quot;redo write time&quot;</span> <span class="n">in</span> <span class="n">centiseconds</span> <span class="p">(</span><span class="mi">100</span> <span class="n">per</span> <span class="n">second</span><span class="p">)</span>
<span class="n">PROMPT</span> <span class="mf">11.1</span><span class="o">:</span> <span class="s">&quot;redo write broadcast ack time&quot;</span> <span class="n">in</span> <span class="n">centiseconds</span> <span class="p">(</span><span class="mi">100</span> <span class="n">per</span> <span class="n">second</span><span class="p">)</span>
<span class="n">PROMPT</span> <span class="mf">11.2</span><span class="o">:</span> <span class="s">&quot;redo write broadcast ack time&quot;</span> <span class="n">in</span> <span class="n">microseconds</span> <span class="p">(</span><span class="mi">1000</span> <span class="n">per</span> <span class="n">millisecond</span><span class="p">)</span>
<span class="n">column</span> <span class="n">value</span> <span class="n">format</span> <span class="mi">99999999999999999999</span>
<span class="n">column</span> <span class="n">milliseconds</span> <span class="n">format</span> <span class="mf">99999999999999.999</span>
<span class="n">select</span> <span class="n">v</span><span class="p">.</span><span class="n">version</span><span class="p">,</span> <span class="n">ss</span><span class="p">.</span><span class="n">inst_id</span><span class="p">,</span> <span class="n">ss</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ss</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
<span class="n">decode</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
<span class="err">&#39;</span><span class="mf">11.1</span><span class="err">&#39;</span><span class="p">,</span><span class="n">decode</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">broadcast</span> <span class="n">ack</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span>
<span class="err">&#39;</span><span class="mf">11.2</span><span class="err">&#39;</span><span class="p">,</span><span class="n">decode</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">broadcast</span> <span class="n">ack</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">/</span><span class="mi">1000</span><span class="p">),</span>
<span class="n">decode</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span> <span class="n">milliseconds</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">sysstat</span> <span class="n">ss</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">instance</span> <span class="n">v</span>
<span class="n">where</span> <span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">ASH</span> <span class="n">THRESHOLD</span><span class="p">...</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">This</span> <span class="n">will</span> <span class="n">be</span> <span class="n">the</span> <span class="n">threshold</span> <span class="n">in</span> <span class="n">milliseconds</span> <span class="k">for</span> <span class="n">average</span> <span class="n">log</span> <span class="n">file</span> <span class="n">sync</span>
<span class="n">PROMPT</span> <span class="n">times</span><span class="p">.</span> <span class="n">This</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">the</span> <span class="n">next</span> <span class="n">queries</span> <span class="n">to</span> <span class="n">look</span> <span class="k">for</span> <span class="n">the</span> <span class="n">worst</span>
<span class="n">PROMPT</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span> <span class="n">minutes</span><span class="p">.</span> <span class="n">Any</span> <span class="n">minutes</span> <span class="n">that</span> <span class="n">have</span> <span class="n">an</span> <span class="n">average</span> <span class="n">log</span> <span class="n">file</span>
<span class="n">PROMPT</span> <span class="n">sync</span> <span class="n">time</span> <span class="n">greater</span> <span class="n">than</span> <span class="n">the</span> <span class="n">threshold</span> <span class="n">will</span> <span class="n">be</span> <span class="n">analyzed</span> <span class="n">further</span><span class="p">.</span>
<span class="n">column</span> <span class="n">threshold_in_ms</span> <span class="n">new_value</span> <span class="n">threshold</span> <span class="n">format</span> <span class="mf">999999999.999</span>
<span class="n">select</span> <span class="n">min</span><span class="p">(</span><span class="n">threshold_in_ms</span><span class="p">)</span> <span class="n">threshold_in_ms</span>
<span class="n">from</span> <span class="p">(</span><span class="n">select</span> <span class="n">inst_id</span><span class="p">,</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">minute</span><span class="p">,</span>
<span class="n">avg</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="n">threshold_in_ms</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">active_session_history</span>
<span class="n">where</span> <span class="n">event</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">inst_id</span><span class="p">,</span><span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">3</span> <span class="n">desc</span><span class="p">)</span>
<span class="n">where</span> <span class="n">rownum</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">ASH</span> <span class="n">WORST</span> <span class="n">MINUTES</span> <span class="n">FOR</span> <span class="n">LOG</span> <span class="kt">FILE</span> <span class="n">SYNC</span> <span class="n">WAITS</span><span class="o">:</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">APPROACH</span><span class="o">:</span> <span class="n">These</span> <span class="n">are</span> <span class="n">the</span> <span class="n">minutes</span> <span class="n">where</span> <span class="n">the</span> <span class="n">avg</span> <span class="n">log</span> <span class="n">file</span> <span class="n">sync</span> <span class="n">time</span>
<span class="n">PROMPT</span> <span class="n">was</span> <span class="n">the</span> <span class="n">highest</span> <span class="p">(</span><span class="n">in</span> <span class="n">milliseconds</span><span class="p">).</span>
<span class="n">column</span> <span class="n">event</span> <span class="n">format</span> <span class="n">a30</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">program</span> <span class="n">format</span> <span class="n">a35</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">total_wait_time</span> <span class="n">format</span> <span class="mf">999999999999.999</span>
<span class="n">column</span> <span class="n">avg_time_waited</span> <span class="n">format</span> <span class="mf">999999999999.999</span>
<span class="n">select</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">minute</span><span class="p">,</span> <span class="n">inst_id</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span>
<span class="n">sum</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="n">TOTAL_WAIT_TIME</span> <span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">WAITS</span><span class="p">,</span>
<span class="n">avg</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="n">AVG_TIME_WAITED</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">active_session_history</span>
<span class="n">where</span> <span class="n">event</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">),</span> <span class="n">inst_id</span><span class="p">,</span> <span class="n">event</span>
<span class="n">having</span> <span class="n">avg</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="o">&gt;</span> <span class="o">&amp;&amp;</span><span class="n">threshold</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">ASH</span> <span class="n">LFS</span> <span class="n">BACKGROUND</span> <span class="n">PROCESS</span> <span class="n">WAITS</span> <span class="n">DURING</span> <span class="n">WORST</span> <span class="n">MINUTES</span><span class="o">:</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">APPROACH</span><span class="o">:</span> <span class="n">What</span> <span class="n">is</span> <span class="n">LGWR</span> <span class="n">doing</span> <span class="n">when</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span> <span class="n">waits</span>
<span class="n">PROMPT</span> <span class="n">are</span> <span class="n">happening</span><span class="o">?</span> <span class="n">LMS</span> <span class="n">info</span> <span class="n">may</span> <span class="n">be</span> <span class="n">relevent</span> <span class="k">for</span> <span class="n">broadcast</span>
<span class="n">PROMPT</span> <span class="n">on</span> <span class="n">commit</span> <span class="n">and</span> <span class="n">LNS</span> <span class="n">data</span> <span class="n">may</span> <span class="n">be</span> <span class="n">relevant</span> <span class="k">for</span> <span class="n">dataguard</span><span class="p">.</span>
<span class="n">PROMPT</span> <span class="n">If</span> <span class="n">more</span> <span class="n">details</span> <span class="n">are</span> <span class="n">needed</span> <span class="n">see</span> <span class="n">the</span> <span class="n">ASH</span> <span class="n">DETAILS</span> <span class="n">FOR</span> <span class="n">WORST</span>
<span class="n">PROMPT</span> <span class="n">MINUTES</span> <span class="n">section</span> <span class="n">at</span> <span class="n">the</span> <span class="n">bottom</span> <span class="n">of</span> <span class="n">the</span> <span class="n">report</span><span class="p">.</span>
<span class="n">column</span> <span class="n">inst</span> <span class="n">format</span> <span class="mi">999</span>
<span class="n">column</span> <span class="n">event</span> <span class="n">format</span> <span class="n">a30</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">program</span> <span class="n">format</span> <span class="n">a35</span> <span class="n">wra</span>
<span class="n">select</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">minute</span><span class="p">,</span> <span class="n">inst_id</span> <span class="n">inst</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span>
<span class="n">sum</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="n">TOTAL_WAIT_TIME</span> <span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">WAITS</span><span class="p">,</span>
<span class="n">avg</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="n">AVG_TIME_WAITED</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">active_session_history</span>
<span class="n">where</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">active_session_history</span>
<span class="n">where</span> <span class="n">event</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">),</span> <span class="n">inst_id</span>
<span class="n">having</span> <span class="n">avg</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="o">&gt;</span> <span class="o">&amp;&amp;</span><span class="n">threshold</span><span class="p">)</span>
<span class="n">and</span> <span class="p">(</span><span class="n">program</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LGWR</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">program</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LMS</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span>
<span class="n">program</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LNS</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">event</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">),</span> <span class="n">inst_id</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">event</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span> <span class="n">desc</span><span class="p">,</span> <span class="mi">4</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">AWR</span> <span class="n">WORST</span> <span class="n">AVG</span> <span class="n">LOG</span> <span class="kt">FILE</span> <span class="n">SYNC</span> <span class="n">SNAPS</span><span class="o">:</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">APPROACH</span><span class="o">:</span> <span class="n">These</span> <span class="n">are</span> <span class="n">the</span> <span class="n">AWR</span> <span class="n">snaps</span> <span class="n">where</span> <span class="n">the</span> <span class="n">average</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">PROMPT</span> <span class="n">times</span> <span class="n">were</span> <span class="n">the</span> <span class="n">highest</span><span class="p">.</span>
<span class="n">column</span> <span class="n">begin</span> <span class="n">format</span> <span class="n">a12</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">end</span> <span class="n">format</span> <span class="n">a12</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">name</span> <span class="n">format</span> <span class="n">a13</span> <span class="n">tru</span>
<span class="n">select</span> <span class="n">dhs</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">dhs</span><span class="p">.</span><span class="n">instance_number</span> <span class="n">inst</span><span class="p">,</span> <span class="n">to_char</span><span class="p">(</span><span class="n">dhs</span><span class="p">.</span><span class="n">begin_interval_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">BEGIN</span><span class="p">,</span>
<span class="n">to_char</span><span class="p">(</span><span class="n">dhs</span><span class="p">.</span><span class="n">end_interval_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">END</span><span class="p">,</span>
<span class="n">en</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="n">total_wait_time</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span><span class="p">,</span>
<span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span> <span class="n">avg_time_waited</span>
<span class="n">from</span> <span class="n">dba_hist_snapshot</span> <span class="n">dhs</span><span class="p">,</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_system_event</span> <span class="n">se</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="p">(</span><span class="n">dhs</span><span class="p">.</span><span class="n">snap_id</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span> <span class="n">and</span> <span class="n">dhs</span><span class="p">.</span><span class="n">instance_number</span> <span class="o">=</span> <span class="n">se</span><span class="p">.</span><span class="n">instance_number</span><span class="p">)</span>
<span class="n">and</span> <span class="n">se</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span> <span class="n">and</span>
<span class="n">dhs</span><span class="p">.</span><span class="n">snap_id</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span> <span class="n">snap_id</span> <span class="n">from</span> <span class="p">(</span>
<span class="n">select</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span> <span class="n">avg_time_waited</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_system_event</span> <span class="n">se</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">se</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">avg_time_waited</span> <span class="n">desc</span><span class="p">)</span>
<span class="n">where</span> <span class="n">rownum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">AWR</span> <span class="n">REDO</span> <span class="n">WRITE</span> <span class="n">STATS</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="s">&quot;redo write time&quot;</span> <span class="n">in</span> <span class="n">centiseconds</span> <span class="p">(</span><span class="mi">100</span> <span class="n">per</span> <span class="n">second</span><span class="p">)</span>
<span class="n">PROMPT</span> <span class="mf">11.1</span><span class="o">:</span> <span class="s">&quot;redo write broadcast ack time&quot;</span> <span class="n">in</span> <span class="n">centiseconds</span> <span class="p">(</span><span class="mi">100</span> <span class="n">per</span> <span class="n">second</span><span class="p">)</span>
<span class="n">PROMPT</span> <span class="mf">11.2</span><span class="o">:</span> <span class="s">&quot;redo write broadcast ack time&quot;</span> <span class="n">in</span> <span class="n">microseconds</span> <span class="p">(</span><span class="mi">1000</span> <span class="n">per</span> <span class="n">millisecond</span><span class="p">)</span>
<span class="n">column</span> <span class="n">stat_name</span> <span class="n">format</span> <span class="n">a30</span> <span class="n">tru</span>
<span class="n">select</span> <span class="n">v</span><span class="p">.</span><span class="n">version</span><span class="p">,</span> <span class="n">ss</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">ss</span><span class="p">.</span><span class="n">instance_number</span> <span class="n">inst</span><span class="p">,</span> <span class="n">sn</span><span class="p">.</span><span class="n">stat_name</span><span class="p">,</span> <span class="n">ss</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
<span class="n">decode</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
<span class="err">&#39;</span><span class="mf">11.1</span><span class="err">&#39;</span><span class="p">,</span><span class="n">decode</span> <span class="p">(</span><span class="n">stat_name</span><span class="p">,</span><span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">broadcast</span> <span class="n">ack</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span>
<span class="err">&#39;</span><span class="mf">11.2</span><span class="err">&#39;</span><span class="p">,</span><span class="n">decode</span> <span class="p">(</span><span class="n">stat_name</span><span class="p">,</span><span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">broadcast</span> <span class="n">ack</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">/</span><span class="mi">1000</span><span class="p">),</span>
<span class="n">decode</span> <span class="p">(</span><span class="n">stat_name</span><span class="p">,</span><span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span> <span class="n">time</span><span class="err">&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span> <span class="n">milliseconds</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_sysstat</span> <span class="n">ss</span><span class="p">,</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_stat_name</span> <span class="n">sn</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">instance</span> <span class="n">v</span>
<span class="n">where</span> <span class="n">ss</span><span class="p">.</span><span class="n">stat_id</span> <span class="o">=</span> <span class="n">sn</span><span class="p">.</span><span class="n">stat_id</span>
<span class="n">and</span> <span class="n">sn</span><span class="p">.</span><span class="n">stat_name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="n">redo</span> <span class="n">write</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">and</span> <span class="n">ss</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">and</span> <span class="n">ss</span><span class="p">.</span><span class="n">snap_id</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span> <span class="n">snap_id</span> <span class="n">from</span> <span class="p">(</span>
<span class="n">select</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span> <span class="n">avg_time_waited</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_system_event</span> <span class="n">se</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">se</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">avg_time_waited</span> <span class="n">desc</span><span class="p">)</span>
<span class="n">where</span> <span class="n">rownum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">AWR</span> <span class="n">LFS</span> <span class="n">AND</span> <span class="n">OTHER</span> <span class="n">RELATED</span> <span class="n">WAITS</span> <span class="n">FOR</span> <span class="n">WORST</span> <span class="n">LFS</span> <span class="n">AWRs</span><span class="o">:</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">APPROACH</span><span class="o">:</span> <span class="n">These</span> <span class="n">are</span> <span class="n">the</span> <span class="n">AWR</span> <span class="n">snaps</span> <span class="n">where</span> <span class="n">the</span> <span class="n">average</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">PROMPT</span> <span class="n">times</span> <span class="n">were</span> <span class="n">the</span> <span class="n">highest</span><span class="p">.</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">related</span> <span class="n">waits</span> <span class="n">at</span> <span class="n">those</span> <span class="n">times</span><span class="p">.</span>
<span class="n">column</span> <span class="n">name</span> <span class="n">format</span> <span class="n">a40</span> <span class="n">tru</span>
<span class="n">select</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">instance_number</span> <span class="n">inst</span><span class="p">,</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
<span class="n">se</span><span class="p">.</span><span class="n">total_waits</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="n">total_wait_time</span><span class="p">,</span>
<span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span> <span class="n">avg_time_waited</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_system_event</span> <span class="n">se</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">se</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span> <span class="p">(</span><span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">in</span>
<span class="p">(</span><span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="sc">&#39;,&#39;</span><span class="n">gcs</span> <span class="n">log</span> <span class="n">flush</span> <span class="n">sync</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">parallel</span> <span class="n">write</span><span class="sc">&#39;,&#39;</span><span class="n">wait</span> <span class="k">for</span> <span class="n">scn</span> <span class="n">ack</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="k">switch</span> <span class="n">completion</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">cr</span> <span class="n">grant</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">gc</span> <span class="n">buffer</span> <span class="n">busy</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">current</span> <span class="n">block</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">or</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LGWR</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LNS</span><span class="o">%</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">and</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span> <span class="n">snap_id</span> <span class="n">from</span> <span class="p">(</span>
<span class="n">select</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span> <span class="n">avg_time_waited</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_system_event</span> <span class="n">se</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">se</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">avg_time_waited</span> <span class="n">desc</span><span class="p">)</span>
<span class="n">where</span> <span class="n">rownum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span> <span class="n">desc</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">AWR</span> <span class="n">HISTOGRAM</span> <span class="n">DATA</span> <span class="n">FOR</span> <span class="n">LFS</span> <span class="n">AND</span> <span class="n">OTHER</span> <span class="n">RELATED</span> <span class="n">WAITS</span> <span class="n">FOR</span> <span class="n">WORST</span> <span class="n">LFS</span> <span class="n">AWRs</span><span class="o">:</span>
<span class="n">PROMPT</span> <span class="n">Note</span><span class="o">:</span> <span class="n">This</span> <span class="n">query</span> <span class="n">won</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">work</span> <span class="n">on</span> <span class="mf">10.2</span> <span class="o">-</span> <span class="n">ORA</span><span class="o">-</span><span class="mi">942</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">APPROACH</span><span class="o">:</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">the</span> <span class="n">wait</span> <span class="n">distribution</span> <span class="k">for</span> <span class="n">log</span> <span class="n">file</span> <span class="n">sync</span> <span class="n">waits</span>
<span class="n">PROMPT</span> <span class="n">by</span> <span class="n">looking</span> <span class="n">at</span> <span class="s">&quot;wait_time_milli&quot;</span><span class="p">.</span> <span class="n">Look</span> <span class="n">at</span> <span class="n">the</span> <span class="n">high</span> <span class="n">wait</span> <span class="n">times</span> <span class="n">then</span>
<span class="n">PROMPT</span> <span class="n">see</span> <span class="k">if</span> <span class="n">you</span> <span class="n">can</span> <span class="n">correlate</span> <span class="n">those</span> <span class="n">with</span> <span class="n">other</span> <span class="n">related</span> <span class="n">wait</span> <span class="n">events</span><span class="p">.</span>
<span class="n">select</span> <span class="n">eh</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">eh</span><span class="p">.</span><span class="n">instance_number</span> <span class="n">inst</span><span class="p">,</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">eh</span><span class="p">.</span><span class="n">wait_time_milli</span><span class="p">,</span> <span class="n">eh</span><span class="p">.</span><span class="n">wait_count</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_event_histogram</span> <span class="n">eh</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">eh</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span>
<span class="p">(</span><span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">in</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="sc">&#39;,&#39;</span><span class="n">gcs</span> <span class="n">log</span> <span class="n">flush</span> <span class="n">sync</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">parallel</span> <span class="n">write</span><span class="sc">&#39;,&#39;</span><span class="n">wait</span> <span class="k">for</span> <span class="n">scn</span> <span class="n">ack</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="k">switch</span> <span class="n">completion</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">cr</span> <span class="n">grant</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">gc</span> <span class="n">buffer</span> <span class="n">busy</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">current</span> <span class="n">block</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">or</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LGWR</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LNS</span><span class="o">%</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">and</span> <span class="n">snap_id</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span> <span class="n">snap_id</span> <span class="n">from</span> <span class="p">(</span>
<span class="n">select</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span> <span class="n">avg_time_waited</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_system_event</span> <span class="n">se</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">se</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">avg_time_waited</span> <span class="n">desc</span><span class="p">)</span>
<span class="n">where</span> <span class="n">rownum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span> <span class="n">desc</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">ORDERED</span> <span class="n">BY</span> <span class="n">WAIT_TIME_MILLI</span>
<span class="n">PROMPT</span> <span class="n">Note</span><span class="o">:</span> <span class="n">This</span> <span class="n">query</span> <span class="n">won</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">work</span> <span class="n">on</span> <span class="mf">10.2</span> <span class="o">-</span> <span class="n">ORA</span><span class="o">-</span><span class="mi">942</span>
<span class="n">select</span> <span class="n">eh</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">eh</span><span class="p">.</span><span class="n">instance_number</span> <span class="n">inst</span><span class="p">,</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">eh</span><span class="p">.</span><span class="n">wait_time_milli</span><span class="p">,</span> <span class="n">eh</span><span class="p">.</span><span class="n">wait_count</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_event_histogram</span> <span class="n">eh</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">eh</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span>
<span class="p">(</span><span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">in</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="sc">&#39;,&#39;</span><span class="n">gcs</span> <span class="n">log</span> <span class="n">flush</span> <span class="n">sync</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">parallel</span> <span class="n">write</span><span class="sc">&#39;,&#39;</span><span class="n">wait</span> <span class="k">for</span> <span class="n">scn</span> <span class="n">ack</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="k">switch</span> <span class="n">completion</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">cr</span> <span class="n">grant</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">,</span>
<span class="err">&#39;</span><span class="n">gc</span> <span class="n">buffer</span> <span class="n">busy</span><span class="sc">&#39;,&#39;</span><span class="n">gc</span> <span class="n">current</span> <span class="n">block</span> <span class="mi">2</span><span class="o">-</span><span class="n">way</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">or</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LGWR</span><span class="o">%</span><span class="err">&#39;</span> <span class="n">or</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="n">like</span> <span class="err">&#39;</span><span class="o">%</span><span class="n">LNS</span><span class="o">%</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">and</span> <span class="n">snap_id</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span> <span class="n">snap_id</span> <span class="n">from</span> <span class="p">(</span>
<span class="n">select</span> <span class="n">se</span><span class="p">.</span><span class="n">snap_id</span><span class="p">,</span> <span class="n">se</span><span class="p">.</span><span class="n">time_waited_micro</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">se</span><span class="p">.</span><span class="n">total_waits</span> <span class="n">avg_time_waited</span>
<span class="n">from</span> <span class="n">wrh</span><span class="err">$</span><span class="n">_system_event</span> <span class="n">se</span><span class="p">,</span> <span class="n">v</span><span class="err">$</span><span class="n">event_name</span> <span class="n">en</span>
<span class="n">where</span> <span class="n">se</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">en</span><span class="p">.</span><span class="n">event_id</span> <span class="n">and</span> <span class="n">en</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">avg_time_waited</span> <span class="n">desc</span><span class="p">)</span>
<span class="n">where</span> <span class="n">rownum</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span> <span class="n">desc</span><span class="p">;</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">ASH</span> <span class="n">DETAILS</span> <span class="n">FOR</span> <span class="n">WORST</span> <span class="n">MINUTES</span><span class="o">:</span>
<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">APPROACH</span><span class="o">:</span> <span class="n">If</span> <span class="n">you</span> <span class="n">cannot</span> <span class="n">determine</span> <span class="n">the</span> <span class="n">problem</span> <span class="n">from</span> <span class="n">the</span> <span class="n">data</span>
<span class="n">PROMPT</span> <span class="n">above</span><span class="p">,</span> <span class="n">you</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">look</span> <span class="n">at</span> <span class="n">the</span> <span class="n">details</span> <span class="n">of</span> <span class="n">what</span> <span class="n">each</span> <span class="n">session</span>
<span class="n">PROMPT</span> <span class="n">is</span> <span class="n">doing</span> <span class="n">during</span> <span class="n">each</span> <span class="err">&#39;</span><span class="n">bad</span><span class="err">&#39;</span> <span class="n">snap</span><span class="p">.</span> <span class="n">Most</span> <span class="n">likely</span> <span class="n">you</span> <span class="n">will</span> <span class="n">want</span> <span class="n">to</span>
<span class="n">PROMPT</span> <span class="n">note</span> <span class="n">the</span> <span class="n">times</span> <span class="n">of</span> <span class="n">the</span> <span class="n">high</span> <span class="n">log</span> <span class="n">file</span> <span class="n">sync</span> <span class="n">waits</span><span class="p">,</span> <span class="n">look</span> <span class="n">at</span> <span class="n">what</span>
<span class="n">PROMPT</span> <span class="n">LGWR</span> <span class="n">is</span> <span class="n">doing</span> <span class="n">at</span> <span class="n">those</span> <span class="n">times</span><span class="p">,</span> <span class="n">and</span> <span class="n">go</span> <span class="n">from</span> <span class="n">there</span><span class="p">...</span>
<span class="n">column</span> <span class="n">program</span> <span class="n">format</span> <span class="n">a45</span> <span class="n">wra</span>
<span class="n">column</span> <span class="n">sample_time</span> <span class="n">format</span> <span class="n">a25</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">event</span> <span class="n">format</span> <span class="n">a30</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">time_waited</span> <span class="n">format</span> <span class="mf">999999.999</span>
<span class="n">column</span> <span class="n">p1</span> <span class="n">format</span> <span class="n">a40</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">p2</span> <span class="n">format</span> <span class="n">a40</span> <span class="n">tru</span>
<span class="n">column</span> <span class="n">p3</span> <span class="n">format</span> <span class="n">a40</span> <span class="n">tru</span>
<span class="n">select</span> <span class="n">sample_time</span><span class="p">,</span> <span class="n">inst_id</span> <span class="n">inst</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">program</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">time_waited</span><span class="o">/</span><span class="mi">1000</span> <span class="n">TIME_WAITED</span><span class="p">,</span>
<span class="n">p1text</span><span class="o">||</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="o">||</span><span class="n">p1</span> <span class="n">p1</span><span class="p">,</span><span class="n">p2text</span><span class="o">||</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="o">||</span><span class="n">p2</span> <span class="n">p2</span><span class="p">,</span><span class="n">p3text</span><span class="o">||</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="o">||</span><span class="n">p3</span> <span class="n">p3</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">active_session_history</span>
<span class="n">where</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">in</span> <span class="p">(</span><span class="n">select</span>
<span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">from</span> <span class="n">gv</span><span class="err">$</span><span class="n">active_session_history</span>
<span class="n">where</span> <span class="n">event</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">log</span> <span class="n">file</span> <span class="n">sync</span><span class="err">&#39;</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sample_time</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd_hh24mi</span><span class="err">&#39;</span><span class="p">),</span> <span class="n">inst_id</span>
<span class="n">having</span> <span class="n">avg</span><span class="p">(</span><span class="n">time_waited</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span> <span class="o">&gt;</span> <span class="o">&amp;&amp;</span><span class="n">threshold</span><span class="p">)</span>
<span class="n">order</span> <span class="n">by</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">;</span>

<span class="n">select</span> <span class="n">to_char</span><span class="p">(</span><span class="n">sysdate</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Mondd</span> <span class="n">hh24</span><span class="o">:</span><span class="n">mi</span><span class="o">:</span><span class="n">ss</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">TIME</span> <span class="n">from</span> <span class="n">dual</span><span class="p">;</span>

<span class="n">spool</span> <span class="n">off</span>

<span class="n">PROMPT</span>
<span class="n">PROMPT</span> <span class="n">OUTPUT</span> <span class="kt">FILE</span> <span class="n">IS</span><span class="o">:</span> <span class="n">lfsdiag_</span><span class="o">&amp;&amp;</span><span class="n">dbname</span><span class="o">&amp;&amp;</span><span class="n">timestamp</span><span class="o">&amp;&amp;</span><span class="n">suffix</span>
<span class="n">PROMPT</span>
</pre></div>


<h1 id="gloginsql">glogin.sql</h1>
<div class="hlcode"><pre><span class="o">--</span>
<span class="o">--</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">1988</span><span class="p">,</span> <span class="mi">2004</span><span class="p">,</span> <span class="n">Oracle</span> <span class="n">Corporation</span><span class="p">.</span>  <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span><span class="p">.</span>
<span class="o">--</span>
<span class="o">--</span> <span class="n">NAME</span>
<span class="o">--</span>   <span class="n">glogin</span><span class="p">.</span><span class="n">sql</span>
<span class="o">--</span>
<span class="o">--</span> <span class="n">DESCRIPTION</span>
<span class="o">--</span>   <span class="n">SQL</span><span class="o">*</span><span class="n">Plus</span> <span class="n">global</span> <span class="n">login</span> <span class="s">&quot;site profile&quot;</span> <span class="n">file</span>
<span class="o">--</span>
<span class="o">--</span>   <span class="n">Add</span> <span class="n">any</span> <span class="n">SQL</span><span class="o">*</span><span class="n">Plus</span> <span class="n">commands</span> <span class="n">here</span> <span class="n">that</span> <span class="n">are</span> <span class="n">to</span> <span class="n">be</span> <span class="n">executed</span> <span class="n">when</span> <span class="n">a</span>
<span class="o">--</span>   <span class="n">user</span> <span class="n">starts</span> <span class="n">SQL</span><span class="o">*</span><span class="n">Plus</span><span class="p">,</span> <span class="n">or</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">SQL</span><span class="o">*</span><span class="n">Plus</span> <span class="n">CONNECT</span> <span class="n">command</span>
<span class="o">--</span>
<span class="o">--</span> <span class="n">USAGE</span>
<span class="o">--</span>   <span class="n">This</span> <span class="n">script</span> <span class="n">is</span> <span class="n">automatically</span> <span class="n">run</span>
<span class="o">--</span>

<span class="o">--</span> <span class="n">Used</span> <span class="n">by</span> <span class="n">Trusted</span> <span class="n">Oracle</span>
<span class="n">COLUMN</span> <span class="n">ROWLABEL</span> <span class="n">FORMAT</span> <span class="n">A15</span>

<span class="o">--</span> <span class="n">Used</span> <span class="k">for</span> <span class="n">the</span> <span class="n">SHOW</span> <span class="n">ERRORS</span> <span class="n">command</span>
<span class="n">COLUMN</span> <span class="n">LINE</span><span class="o">/</span><span class="n">COL</span> <span class="n">FORMAT</span> <span class="n">A8</span>
<span class="n">COLUMN</span> <span class="n">ERROR</span>    <span class="n">FORMAT</span> <span class="n">A65</span>  <span class="n">WORD_WRAPPED</span>

<span class="o">--</span> <span class="n">Used</span> <span class="k">for</span> <span class="n">the</span> <span class="n">SHOW</span> <span class="n">SGA</span> <span class="n">command</span>
<span class="n">COLUMN</span> <span class="n">name_col_plus_show_sga</span> <span class="n">FORMAT</span> <span class="n">a24</span>
<span class="n">COLUMN</span> <span class="n">units_col_plus_show_sga</span> <span class="n">FORMAT</span> <span class="n">a15</span>
<span class="o">--</span> <span class="n">Defaults</span> <span class="k">for</span> <span class="n">SHOW</span> <span class="n">PARAMETERS</span>
<span class="n">COLUMN</span> <span class="n">name_col_plus_show_param</span> <span class="n">FORMAT</span> <span class="n">a36</span> <span class="n">HEADING</span> <span class="n">NAME</span>
<span class="n">COLUMN</span> <span class="n">value_col_plus_show_param</span> <span class="n">FORMAT</span> <span class="n">a30</span> <span class="n">HEADING</span> <span class="n">VALUE</span>

<span class="o">--</span> <span class="n">Defaults</span> <span class="k">for</span> <span class="n">SHOW</span> <span class="n">RECYCLEBIN</span>
<span class="n">COLUMN</span> <span class="n">origname_plus_show_recyc</span>   <span class="n">FORMAT</span> <span class="n">a16</span> <span class="n">HEADING</span> <span class="err">&#39;</span><span class="n">ORIGINAL</span> <span class="n">NAME</span><span class="err">&#39;</span>
<span class="n">COLUMN</span> <span class="n">objectname_plus_show_recyc</span> <span class="n">FORMAT</span> <span class="n">a30</span> <span class="n">HEADING</span> <span class="err">&#39;</span><span class="n">RECYCLEBIN</span> <span class="n">NAME</span><span class="err">&#39;</span>
<span class="n">COLUMN</span> <span class="n">objtype_plus_show_recyc</span>    <span class="n">FORMAT</span> <span class="n">a12</span> <span class="n">HEADING</span> <span class="err">&#39;</span><span class="n">OBJECT</span> <span class="n">TYPE</span><span class="err">&#39;</span>
<span class="n">COLUMN</span> <span class="n">droptime_plus_show_recyc</span>   <span class="n">FORMAT</span> <span class="n">a19</span> <span class="n">HEADING</span> <span class="err">&#39;</span><span class="n">DROP</span> <span class="n">TIME</span><span class="err">&#39;</span>

<span class="o">--</span> <span class="n">Defaults</span> <span class="k">for</span> <span class="n">SET</span> <span class="n">AUTOTRACE</span> <span class="n">EXPLAIN</span> <span class="n">report</span>
<span class="o">--</span> <span class="n">These</span> <span class="n">column</span> <span class="n">definitions</span> <span class="n">are</span> <span class="n">only</span> <span class="n">used</span> <span class="n">when</span> <span class="n">SQL</span><span class="o">*</span><span class="n">Plus</span>
<span class="o">--</span> <span class="n">is</span> <span class="n">connected</span> <span class="n">to</span> <span class="n">Oracle</span> <span class="mf">9.2</span> <span class="n">or</span> <span class="n">earlier</span><span class="p">.</span>
<span class="n">COLUMN</span> <span class="n">id_plus_exp</span> <span class="n">FORMAT</span> <span class="mi">990</span> <span class="n">HEADING</span> <span class="n">i</span>
<span class="n">COLUMN</span> <span class="n">parent_id_plus_exp</span> <span class="n">FORMAT</span> <span class="mi">990</span> <span class="n">HEADING</span> <span class="n">p</span>
<span class="n">COLUMN</span> <span class="n">plan_plus_exp</span> <span class="n">FORMAT</span> <span class="n">a60</span>
<span class="n">COLUMN</span> <span class="n">object_node_plus_exp</span> <span class="n">FORMAT</span> <span class="n">a8</span>
<span class="n">COLUMN</span> <span class="n">other_tag_plus_exp</span> <span class="n">FORMAT</span> <span class="n">a29</span>
<span class="n">COLUMN</span> <span class="n">other_plus_exp</span> <span class="n">FORMAT</span> <span class="n">a44</span>

<span class="o">--</span> <span class="n">Default</span> <span class="k">for</span> <span class="n">XQUERY</span>
<span class="n">COLUMN</span> <span class="n">result_plus_xquery</span> <span class="n">HEADING</span> <span class="err">&#39;</span><span class="n">Result</span> <span class="n">Sequence</span><span class="err">&#39;</span>

<span class="n">set</span> <span class="n">termout</span> <span class="n">off</span>

<span class="n">col</span> <span class="n">dbname</span> <span class="n">new_value</span> <span class="n">prompt_dbname</span>
<span class="n">select</span> <span class="n">substr</span><span class="p">(</span><span class="n">global_name</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">instr</span><span class="p">(</span><span class="n">global_name</span><span class="p">,</span><span class="sc">&#39;.&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">dbname</span>
<span class="n">from</span> <span class="n">global_name</span><span class="p">;</span>
<span class="n">set</span> <span class="n">sqlprompt</span> <span class="s">&quot;_USER&#39;@&#39;&amp;&amp;prompt_dbname&gt; &quot;</span>

<span class="o">--</span> <span class="n">set</span> <span class="n">title</span> <span class="n">of</span> <span class="n">CMD</span>
<span class="n">col</span> <span class="n">mysid</span> <span class="n">new_value</span> <span class="n">mysid</span>
<span class="n">alter</span> <span class="n">session</span> <span class="n">set</span> <span class="n">NLS_DATE_FORMAT</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">DD</span><span class="p">.</span><span class="n">MM</span><span class="p">.</span><span class="n">YYYY</span> <span class="n">HH24</span><span class="o">:</span><span class="n">MI</span><span class="o">:</span><span class="n">SS</span><span class="err">&#39;</span><span class="p">;</span>

<span class="n">set</span> <span class="n">serveroutput</span> <span class="n">on</span>
<span class="n">set</span> <span class="n">verify</span> <span class="n">off</span>
<span class="n">set</span> <span class="n">linesize</span> <span class="mi">400</span>
<span class="n">set</span> <span class="n">pagesize</span> <span class="mi">1115</span>
<span class="n">set</span> <span class="n">tab</span> <span class="n">off</span>

<span class="cp">#DEFINE _EDITOR = vim</span>
<span class="n">col</span> <span class="n">STANDBY_DEST</span> <span class="n">format</span> <span class="n">a12</span>
<span class="n">col</span> <span class="n">ARCHIVED</span>    <span class="n">format</span> <span class="n">a8</span>
<span class="n">col</span> <span class="n">FAL</span>         <span class="n">format</span> <span class="n">a3</span>


<span class="n">REM</span> <span class="o">********************</span>
<span class="n">REM</span>   <span class="n">v</span><span class="err">$</span><span class="n">logfile</span>
<span class="n">REM</span> <span class="o">********************</span>
<span class="n">REM</span> <span class="n">GROUP</span><span class="err">#</span>                           <span class="n">NUMBER</span>
<span class="n">REM</span> <span class="n">STATUS</span>                           <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">REM</span> <span class="n">TYPE</span>                             <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">REM</span> <span class="n">MEMBER</span>                           <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">513</span><span class="p">)</span>
<span class="n">col</span> <span class="n">IS_RECOVERY_DEST_FILE</span> <span class="n">format</span> <span class="n">a21</span>


<span class="n">REM</span> <span class="o">**********************</span>
<span class="n">REM</span>   <span class="n">V</span><span class="err">$</span><span class="n">ARCHIVE_DEST</span>
<span class="n">REM</span> <span class="o">**********************</span>
<span class="n">col</span> <span class="n">DEST_NAME</span>    <span class="n">format</span> <span class="n">a19</span>
<span class="n">col</span> <span class="n">STATUS</span>   <span class="n">format</span> <span class="n">a9</span>
<span class="n">col</span> <span class="n">TARGET</span>   <span class="n">format</span> <span class="n">a7</span>
<span class="n">col</span> <span class="n">DESTINATION</span> <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">TRANSMIT_MODE</span>  <span class="n">format</span> <span class="n">a13</span>
<span class="n">col</span> <span class="n">AFFIRM</span>         <span class="n">format</span> <span class="n">a6</span>
<span class="n">col</span> <span class="n">DB_UNIQUE_NAME</span>  <span class="n">format</span> <span class="n">a14</span>


<span class="n">REM</span> <span class="o">**********************</span>
<span class="n">REM</span>   <span class="n">V</span><span class="err">$</span><span class="n">DATABASE</span>
<span class="n">REM</span> <span class="o">**********************</span>
<span class="n">col</span> <span class="n">DBID</span>                         <span class="n">format</span>     <span class="n">NUMBER</span>
<span class="n">col</span> <span class="n">NAME</span>                         <span class="n">format</span> <span class="n">a9</span>
<span class="n">col</span> <span class="n">RESETLOGS_CHANGE</span><span class="err">#</span>            <span class="n">format</span>     <span class="n">NUMBER</span>
<span class="n">col</span> <span class="n">RESETLOGS_TIME</span>               <span class="n">format</span>     <span class="n">DATE</span>
<span class="n">col</span> <span class="n">PROTECTION_MODE</span>              <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">PROTECTION_LEVEL</span>             <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">REMOTE_ARCHIVE</span>               <span class="n">format</span> <span class="n">a14</span>
<span class="n">col</span> <span class="n">DATABASE_ROLE</span>                <span class="n">format</span> <span class="n">a16</span>
<span class="n">col</span> <span class="n">ARCHIVELOG_CHANGE</span><span class="err">#</span>           <span class="n">format</span>     <span class="n">NUMBER</span>
<span class="n">col</span> <span class="n">GUARD_STATUS</span>                 <span class="n">format</span> <span class="n">a12</span>
<span class="n">col</span> <span class="n">FORCE_LOGGING</span>                <span class="n">format</span> <span class="n">a13</span>

<span class="n">REM</span> <span class="o">**********************</span>
<span class="n">REM</span> <span class="n">DBA_COMMON_AUDIT_TRAIL</span>
<span class="n">REM</span> <span class="o">**********************</span>
<span class="n">col</span> <span class="n">AUDIT_TYPE</span> <span class="n">format</span> <span class="n">a18</span>
<span class="n">col</span> <span class="n">DB_USER</span>    <span class="n">format</span> <span class="n">a7</span>
<span class="n">col</span> <span class="n">USERHOST</span>   <span class="n">format</span> <span class="n">a32</span>
<span class="n">col</span> <span class="n">OBJECT_SCHEMA</span> <span class="n">format</span> <span class="n">a13</span>
<span class="n">col</span> <span class="n">OBJECT_NAME</span>   <span class="n">format</span> <span class="n">a11</span>
<span class="n">col</span> <span class="n">SQL_TEXT</span>      <span class="n">format</span> <span class="n">a30</span>

<span class="n">REM</span> <span class="o">**************</span>
<span class="n">REM</span> <span class="n">all_sequences</span>
<span class="n">REM</span> <span class="o">**************</span>
<span class="n">col</span> <span class="n">SEQUENCE_OWNER</span> <span class="n">format</span> <span class="n">a14</span>
<span class="n">col</span> <span class="n">SEQUENCE_NAME</span>  <span class="n">format</span> <span class="n">a25</span>
<span class="n">col</span> <span class="n">CYCLE_FLAG</span>     <span class="n">format</span> <span class="n">a10</span>
<span class="n">col</span> <span class="n">ORDER_FLAG</span>     <span class="n">format</span> <span class="n">a10</span>

<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">REM</span> <span class="n">v</span><span class="err">$</span><span class="n">parameter</span>
<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">col</span> <span class="n">name</span>             <span class="n">format</span> <span class="n">a36</span>
<span class="n">col</span> <span class="n">value</span>            <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">isdefault</span>        <span class="n">format</span> <span class="n">a9</span>
<span class="n">col</span> <span class="n">isses_modifiable</span> <span class="n">format</span> <span class="n">a16</span>
<span class="n">col</span> <span class="n">issys_modifiable</span> <span class="n">format</span> <span class="n">a16</span>

<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">REM</span> <span class="n">v</span><span class="err">$</span><span class="n">sql</span>
<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">col</span> <span class="n">sql_text</span> <span class="n">format</span> <span class="n">a100</span>

<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">REM</span> <span class="n">v</span><span class="err">$</span><span class="n">session</span>
<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">col</span> <span class="n">machine</span> <span class="n">format</span> <span class="n">a22</span>

<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">REM</span> <span class="n">user_tables</span>
<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">col</span> <span class="n">table_name</span> <span class="n">format</span> <span class="n">a30</span>

<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">REM</span> <span class="n">Dictionary</span>
<span class="n">REM</span> <span class="o">*****************</span>
<span class="n">col</span> <span class="n">comments</span>  <span class="n">format</span> <span class="n">a120</span>

<span class="n">REM</span> <span class="o">**************************</span>
<span class="n">REM</span>     <span class="n">Tabelle</span> <span class="n">employees</span>
<span class="n">REM</span> <span class="o">**************************</span>
<span class="n">col</span> <span class="n">first_name</span>   <span class="n">format</span> <span class="n">a11</span>
<span class="n">col</span> <span class="n">last_name</span>    <span class="n">format</span> <span class="n">a11</span>
<span class="n">col</span> <span class="n">email</span>        <span class="n">format</span> <span class="n">a8</span>
<span class="n">col</span> <span class="n">phone_number</span> <span class="n">format</span> <span class="n">a18</span>
<span class="n">col</span> <span class="n">hire_date</span>    <span class="n">format</span> <span class="n">a15</span>

<span class="n">COL</span> <span class="n">owner</span>            <span class="n">format</span> <span class="n">a8</span>
<span class="n">COL</span> <span class="n">search_condition</span> <span class="n">format</span> <span class="n">a30</span>
<span class="n">COL</span> <span class="n">column_name</span>      <span class="n">format</span> <span class="n">a15</span>
<span class="n">COL</span> <span class="n">constraint_name</span>  <span class="n">format</span> <span class="n">a20</span>
<span class="n">COL</span> <span class="n">data_default</span>     <span class="n">format</span> <span class="n">a13</span>
<span class="n">COL</span> <span class="n">text</span>             <span class="n">format</span> <span class="n">a55</span>
<span class="n">COL</span> <span class="n">view_name</span>        <span class="n">format</span> <span class="n">a20</span>
<span class="n">COL</span> <span class="n">index_name</span>       <span class="n">format</span> <span class="n">a22</span>
<span class="n">COL</span> <span class="n">object_name</span>      <span class="n">format</span> <span class="n">a22</span>
<span class="n">COL</span> <span class="n">object_type</span>      <span class="n">format</span> <span class="n">a22</span>
<span class="n">COL</span> <span class="n">trigger_name</span>     <span class="n">format</span> <span class="n">a10</span>
<span class="n">COL</span> <span class="n">table_owner</span>      <span class="n">format</span> <span class="n">a11</span>
<span class="n">COL</span> <span class="n">triggering_event</span> <span class="n">format</span> <span class="n">a10</span>
<span class="n">COL</span> <span class="n">trigger_type</span>     <span class="n">format</span> <span class="n">a16</span>
<span class="n">COL</span> <span class="n">grantee</span>          <span class="n">format</span> <span class="n">a10</span>
<span class="n">COL</span> <span class="n">grantor</span>          <span class="n">format</span> <span class="n">a10</span>
<span class="n">COL</span> <span class="n">role</span>             <span class="n">format</span> <span class="n">a25</span>
<span class="n">COL</span> <span class="n">username</span>         <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">kommentar</span>        <span class="n">format</span> <span class="n">a20</span>
<span class="o">--</span> <span class="n">col</span> <span class="n">name</span>             <span class="n">format</span> <span class="n">a66</span>
<span class="n">col</span> <span class="n">large_pool_size</span>  <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">file_name</span>        <span class="n">format</span> <span class="n">a66</span>
<span class="n">col</span> <span class="n">tablespace_name</span>  <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">segment_name</span>     <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">member</span>           <span class="n">format</span> <span class="n">a60</span>
<span class="n">col</span> <span class="n">description</span>      <span class="n">format</span> <span class="n">a35</span>
<span class="n">col</span> <span class="n">trigger_body</span>     <span class="n">format</span> <span class="n">a35</span>
<span class="n">col</span> <span class="n">parameter</span>        <span class="n">format</span> <span class="n">a35</span>
<span class="n">col</span> <span class="n">data_default</span>     <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">resource_name</span>    <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">limit</span>            <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">profile</span>          <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">attribute</span>        <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">char_value</span>       <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">member</span>           <span class="n">format</span> <span class="n">a50</span>
<span class="n">col</span> <span class="n">host_name</span>        <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="s">&quot;%&quot;</span>              <span class="n">format</span> <span class="mf">990.99</span> <span class="n">justify</span> <span class="n">right</span>
<span class="n">col</span> <span class="n">AVERAGE_WAIT</span>     <span class="n">format</span> <span class="mf">9999990.00</span>
<span class="n">col</span> <span class="n">account_status</span>       <span class="n">format</span> <span class="n">a10</span>
<span class="n">col</span> <span class="n">default_tablespace</span>   <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">temporary_tablespace</span> <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">password</span>         <span class="n">format</span> <span class="n">a17</span>
<span class="n">col</span> <span class="n">modus</span>            <span class="n">format</span> <span class="n">a5</span>
<span class="n">col</span> <span class="n">operation</span>        <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">options</span>          <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">index_free_percentage</span> <span class="n">format</span> <span class="mf">90.99</span>

<span class="n">col</span> <span class="n">os_username</span>      <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">terminal</span>         <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">obj_name</span>         <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">action_time</span>      <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">action_name</span>      <span class="n">format</span> <span class="n">a20</span>

<span class="n">col</span> <span class="n">event</span>            <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">p1text</span>           <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">sid</span>              <span class="n">format</span> <span class="mi">999</span>
<span class="n">col</span> <span class="n">what</span>             <span class="n">format</span> <span class="n">a30</span>

<span class="n">col</span> <span class="n">department_name</span>  <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">property_value</span>   <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">property_name</span>    <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">statistics_name</span>  <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">activation_level</span> <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">optimizer</span>        <span class="n">format</span> <span class="n">a10</span>
<span class="n">col</span> <span class="n">program</span>          <span class="n">format</span> <span class="n">a30</span>
<span class="n">col</span> <span class="n">instance_name</span>    <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">status</span>           <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">type</span>             <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">namespace</span>        <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">osuser</span>           <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">logon_time</span>       <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">deferrable</span>       <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">deferred</span>         <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">r_owner</span>          <span class="n">format</span> <span class="n">a15</span>
<span class="n">col</span> <span class="n">tablespace</span>       <span class="n">format</span> <span class="n">a20</span>
<span class="n">col</span> <span class="n">datafile</span>         <span class="n">format</span> <span class="n">a50</span>
<span class="n">set</span> <span class="n">termout</span> <span class="n">on</span>
</pre></div>


<h1 id="show_spacesql-by-tom-kyte">show_space.sql by Tom Kyte</h1>
<div class="hlcode"><pre><span class="o">--</span> <span class="o">-----------------------------------------------------------------------------------</span>
<span class="o">--</span> <span class="n">Author</span>       <span class="o">:</span> <span class="n">Tom</span> <span class="n">Kyte</span>
<span class="o">--</span> <span class="n">Description</span>  <span class="o">:</span> <span class="n">Displays</span> <span class="n">free</span> <span class="n">and</span> <span class="n">unused</span> <span class="n">space</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">object</span><span class="p">.</span>
<span class="o">--</span> <span class="n">Call</span> <span class="n">Syntax</span>  <span class="o">:</span> <span class="n">EXEC</span> <span class="n">Show_Space</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Tablename</span><span class="err">&#39;</span><span class="p">);</span>
<span class="o">--</span> <span class="n">Requirements</span> <span class="o">:</span> <span class="n">SET</span> <span class="n">SERVEROUTPUT</span> <span class="n">ON</span>
<span class="o">--</span> <span class="n">Last</span> <span class="n">Modified</span><span class="o">:</span> <span class="n">June</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">2010</span>
<span class="o">--</span> <span class="n">This</span> <span class="n">enhance</span> <span class="n">version</span> <span class="n">has</span> <span class="n">all</span> <span class="n">the</span> <span class="n">fixes</span> <span class="k">for</span> <span class="n">ASSM</span><span class="p">,</span> <span class="n">LMT</span><span class="p">,</span> <span class="n">partitions</span> <span class="n">etc</span> <span class="p">(</span><span class="n">Oracle</span> <span class="n">version</span> <span class="mi">10</span><span class="n">gr2</span> <span class="o">+</span><span class="p">)</span>
<span class="o">--</span> <span class="o">-----------------------------------------------------------------------------------</span>
<span class="n">set</span> <span class="n">define</span> <span class="n">off</span>

<span class="n">create</span> <span class="n">or</span> <span class="n">replace</span> <span class="n">procedure</span> <span class="n">show_space</span>
<span class="p">(</span> <span class="n">p_segname</span> <span class="n">in</span> <span class="n">varchar2</span><span class="p">,</span>
  <span class="n">p_owner</span>   <span class="n">in</span> <span class="n">varchar2</span> <span class="k">default</span> <span class="n">user</span><span class="p">,</span>
  <span class="n">p_type</span>    <span class="n">in</span> <span class="n">varchar2</span> <span class="k">default</span> <span class="err">&#39;</span><span class="n">TABLE</span><span class="err">&#39;</span><span class="p">,</span>
  <span class="n">p_partition</span> <span class="n">in</span> <span class="n">varchar2</span> <span class="k">default</span> <span class="nb">NULL</span> <span class="p">)</span>
<span class="o">--</span> <span class="n">this</span> <span class="n">procedure</span> <span class="n">uses</span> <span class="n">authid</span> <span class="n">current</span> <span class="n">user</span> <span class="n">so</span> <span class="n">it</span> <span class="n">can</span> <span class="n">query</span> <span class="n">DBA_</span><span class="o">*</span>
<span class="o">--</span> <span class="n">views</span> <span class="n">using</span> <span class="n">privileges</span> <span class="n">from</span> <span class="n">a</span> <span class="n">ROLE</span> <span class="n">and</span> <span class="n">so</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">installed</span>
<span class="o">--</span> <span class="n">once</span> <span class="n">per</span> <span class="n">database</span><span class="p">,</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">once</span> <span class="n">per</span> <span class="n">user</span> <span class="n">that</span> <span class="n">wanted</span> <span class="n">to</span> <span class="n">use</span> <span class="n">it</span> <span class="n">authid</span> <span class="n">current_user</span>
<span class="n">AUTHID</span> <span class="n">CURRENT_USER</span>
<span class="n">as</span>
    <span class="n">l_free_blks</span>                 <span class="n">number</span><span class="p">;</span>
    <span class="n">l_total_blocks</span>              <span class="n">number</span><span class="p">;</span>
    <span class="n">l_total_bytes</span>               <span class="n">number</span><span class="p">;</span>
    <span class="n">l_unused_blocks</span>             <span class="n">number</span><span class="p">;</span>
    <span class="n">l_unused_bytes</span>              <span class="n">number</span><span class="p">;</span>
    <span class="n">l_LastUsedExtFileId</span>         <span class="n">number</span><span class="p">;</span>
    <span class="n">l_LastUsedExtBlockId</span>        <span class="n">number</span><span class="p">;</span>
    <span class="n">l_LAST_USED_BLOCK</span>           <span class="n">number</span><span class="p">;</span>
    <span class="n">l_segment_space_mgmt</span>        <span class="nf">varchar2</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
    <span class="n">l_unformatted_blocks</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">l_unformatted_bytes</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">l_fs1_blocks</span> <span class="n">number</span><span class="p">;</span> <span class="n">l_fs1_bytes</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">l_fs2_blocks</span> <span class="n">number</span><span class="p">;</span> <span class="n">l_fs2_bytes</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">l_fs3_blocks</span> <span class="n">number</span><span class="p">;</span> <span class="n">l_fs3_bytes</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">l_fs4_blocks</span> <span class="n">number</span><span class="p">;</span> <span class="n">l_fs4_bytes</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">l_full_blocks</span> <span class="n">number</span><span class="p">;</span> <span class="n">l_full_bytes</span> <span class="n">number</span><span class="p">;</span>

    <span class="o">--</span> <span class="kr">inline</span> <span class="n">procedure</span> <span class="n">to</span> <span class="n">print</span> <span class="n">out</span> <span class="n">numbers</span> <span class="n">nicely</span> <span class="n">formatted</span>
    <span class="o">--</span> <span class="n">with</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">label</span>
    <span class="n">procedure</span> <span class="n">p</span><span class="p">(</span> <span class="n">p_label</span> <span class="n">in</span> <span class="n">varchar2</span><span class="p">,</span> <span class="n">p_num</span> <span class="n">in</span> <span class="n">number</span> <span class="p">)</span>
    <span class="n">is</span>
    <span class="n">begin</span>
        <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span> <span class="n">rpad</span><span class="p">(</span><span class="n">p_label</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="sc">&#39;.&#39;</span><span class="p">)</span> <span class="o">||</span>
                              <span class="n">to_char</span><span class="p">(</span><span class="n">p_num</span><span class="p">,</span><span class="err">&#39;</span><span class="mi">999</span><span class="p">,</span><span class="mi">999</span><span class="p">,</span><span class="mi">999</span><span class="p">,</span><span class="mi">999</span><span class="err">&#39;</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">end</span><span class="p">;</span>
<span class="n">begin</span>
   <span class="o">--</span> <span class="n">this</span> <span class="n">query</span> <span class="n">is</span> <span class="n">executed</span> <span class="n">dynamically</span> <span class="n">in</span> <span class="n">order</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">this</span> <span class="n">procedure</span>
   <span class="o">--</span> <span class="n">to</span> <span class="n">be</span> <span class="n">created</span> <span class="n">by</span> <span class="n">a</span> <span class="n">user</span> <span class="n">who</span> <span class="n">has</span> <span class="n">access</span> <span class="n">to</span> <span class="n">DBA_SEGMENTS</span><span class="o">/</span><span class="n">TABLESPACES</span>
   <span class="o">--</span> <span class="n">via</span> <span class="n">a</span> <span class="n">role</span> <span class="n">as</span> <span class="n">is</span> <span class="n">customary</span><span class="p">.</span>
   <span class="o">--</span> <span class="n">NOTE</span><span class="o">:</span> <span class="n">at</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">the</span> <span class="n">invoker</span> <span class="n">MUST</span> <span class="n">have</span> <span class="n">access</span> <span class="n">to</span> <span class="n">these</span> <span class="n">two</span>
   <span class="o">--</span> <span class="n">views</span><span class="o">!</span>
   <span class="o">--</span> <span class="n">this</span> <span class="n">query</span> <span class="n">determines</span> <span class="k">if</span> <span class="n">the</span> <span class="n">object</span> <span class="n">is</span> <span class="n">a</span> <span class="n">ASSM</span> <span class="n">object</span> <span class="n">or</span> <span class="n">not</span>
   <span class="n">begin</span>
      <span class="n">execute</span> <span class="n">immediate</span>
          <span class="err">&#39;</span><span class="n">select</span> <span class="n">ts</span><span class="p">.</span><span class="n">segment_space_management</span>
             <span class="n">from</span> <span class="n">dba_segments</span> <span class="n">seg</span><span class="p">,</span> <span class="n">dba_tablespaces</span> <span class="n">ts</span>
            <span class="n">where</span> <span class="n">seg</span><span class="p">.</span><span class="n">segment_name</span>      <span class="o">=</span> <span class="o">:</span><span class="n">p_segname</span>
              <span class="n">and</span> <span class="p">(</span><span class="o">:</span><span class="n">p_partition</span> <span class="n">is</span> <span class="n">null</span> <span class="n">or</span>
                  <span class="n">seg</span><span class="p">.</span><span class="n">partition_name</span> <span class="o">=</span> <span class="o">:</span><span class="n">p_partition</span><span class="p">)</span>
              <span class="n">and</span> <span class="n">seg</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="o">:</span><span class="n">p_owner</span>
              <span class="n">and</span> <span class="n">seg</span><span class="p">.</span><span class="n">segment_type</span> <span class="o">=</span> <span class="o">:</span><span class="n">p_type</span>
              <span class="n">and</span> <span class="n">seg</span><span class="p">.</span><span class="n">tablespace_name</span> <span class="o">=</span> <span class="n">ts</span><span class="p">.</span><span class="n">tablespace_name</span><span class="err">&#39;</span>
             <span class="n">into</span> <span class="n">l_segment_space_mgmt</span>
            <span class="n">using</span> <span class="n">p_segname</span><span class="p">,</span> <span class="n">p_partition</span><span class="p">,</span> <span class="n">p_partition</span><span class="p">,</span> <span class="n">p_owner</span><span class="p">,</span> <span class="n">p_type</span><span class="p">;</span>
   <span class="n">exception</span>
       <span class="n">when</span> <span class="n">too_many_rows</span> <span class="n">then</span>
          <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span>
          <span class="p">(</span> <span class="err">&#39;</span><span class="n">This</span> <span class="n">must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">partitioned</span> <span class="n">table</span><span class="p">,</span> <span class="n">use</span> <span class="n">p_partition</span> <span class="o">=&gt;</span> <span class="err">&#39;</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
   <span class="n">end</span><span class="p">;</span>


   <span class="o">--</span> <span class="k">if</span> <span class="n">the</span> <span class="n">object</span> <span class="n">is</span> <span class="n">in</span> <span class="n">an</span> <span class="n">ASSM</span> <span class="n">tablespace</span><span class="p">,</span> <span class="n">we</span> <span class="n">must</span> <span class="n">use</span> <span class="n">this</span> <span class="n">API</span>
   <span class="o">--</span> <span class="n">call</span> <span class="n">to</span> <span class="n">get</span> <span class="n">space</span> <span class="n">information</span><span class="p">,</span> <span class="k">else</span> <span class="n">we</span> <span class="n">use</span> <span class="n">the</span> <span class="n">FREE_BLOCKS</span>
   <span class="o">--</span> <span class="n">API</span> <span class="k">for</span> <span class="n">the</span> <span class="n">user</span> <span class="n">managed</span> <span class="n">segments</span>
   <span class="k">if</span> <span class="n">l_segment_space_mgmt</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">AUTO</span><span class="err">&#39;</span>
   <span class="n">then</span>
     <span class="n">dbms_space</span><span class="p">.</span><span class="n">space_usage</span>
     <span class="p">(</span> <span class="n">p_owner</span><span class="p">,</span> <span class="n">p_segname</span><span class="p">,</span> <span class="n">p_type</span><span class="p">,</span> <span class="n">l_unformatted_blocks</span><span class="p">,</span>
       <span class="n">l_unformatted_bytes</span><span class="p">,</span> <span class="n">l_fs1_blocks</span><span class="p">,</span> <span class="n">l_fs1_bytes</span><span class="p">,</span>
       <span class="n">l_fs2_blocks</span><span class="p">,</span> <span class="n">l_fs2_bytes</span><span class="p">,</span> <span class="n">l_fs3_blocks</span><span class="p">,</span> <span class="n">l_fs3_bytes</span><span class="p">,</span>
       <span class="n">l_fs4_blocks</span><span class="p">,</span> <span class="n">l_fs4_bytes</span><span class="p">,</span> <span class="n">l_full_blocks</span><span class="p">,</span> <span class="n">l_full_bytes</span><span class="p">,</span> <span class="n">p_partition</span><span class="p">);</span>

     <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Unformatted</span> <span class="n">Blocks</span> <span class="err">&#39;</span><span class="p">,</span> <span class="n">l_unformatted_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">FS1</span> <span class="n">Blocks</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span>  <span class="err">&#39;</span><span class="p">,</span> <span class="n">l_fs1_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">FS2</span> <span class="n">Blocks</span> <span class="p">(</span><span class="mi">25</span><span class="o">-</span><span class="mi">50</span><span class="p">)</span> <span class="err">&#39;</span><span class="p">,</span> <span class="n">l_fs2_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">FS3</span> <span class="n">Blocks</span> <span class="p">(</span><span class="mi">50</span><span class="o">-</span><span class="mi">75</span><span class="p">)</span> <span class="err">&#39;</span><span class="p">,</span> <span class="n">l_fs3_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">FS4</span> <span class="n">Blocks</span> <span class="p">(</span><span class="mi">75</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_fs4_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Full</span> <span class="n">Blocks</span>        <span class="err">&#39;</span><span class="p">,</span> <span class="n">l_full_blocks</span> <span class="p">);</span>
  <span class="k">else</span>
     <span class="n">dbms_space</span><span class="p">.</span><span class="n">free_blocks</span><span class="p">(</span>
       <span class="n">segment_owner</span>     <span class="o">=&gt;</span> <span class="n">p_owner</span><span class="p">,</span>
       <span class="n">segment_name</span>      <span class="o">=&gt;</span> <span class="n">p_segname</span><span class="p">,</span>
       <span class="n">segment_type</span>      <span class="o">=&gt;</span> <span class="n">p_type</span><span class="p">,</span>
       <span class="n">freelist_group_id</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
       <span class="n">free_blks</span>         <span class="o">=&gt;</span> <span class="n">l_free_blks</span><span class="p">);</span>

     <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Free</span> <span class="n">Blocks</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_free_blks</span> <span class="p">);</span>
  <span class="n">end</span> <span class="k">if</span><span class="p">;</span>

  <span class="o">--</span> <span class="n">and</span> <span class="n">then</span> <span class="n">the</span> <span class="n">unused</span> <span class="n">space</span> <span class="n">API</span> <span class="n">call</span> <span class="n">to</span> <span class="n">get</span> <span class="n">the</span> <span class="n">rest</span> <span class="n">of</span> <span class="n">the</span>
  <span class="o">--</span> <span class="n">information</span>
  <span class="n">dbms_space</span><span class="p">.</span><span class="n">unused_space</span>
  <span class="p">(</span> <span class="n">segment_owner</span>     <span class="o">=&gt;</span> <span class="n">p_owner</span><span class="p">,</span>
    <span class="n">segment_name</span>      <span class="o">=&gt;</span> <span class="n">p_segname</span><span class="p">,</span>
    <span class="n">segment_type</span>      <span class="o">=&gt;</span> <span class="n">p_type</span><span class="p">,</span>
    <span class="n">partition_name</span>    <span class="o">=&gt;</span> <span class="n">p_partition</span><span class="p">,</span>
    <span class="n">total_blocks</span>      <span class="o">=&gt;</span> <span class="n">l_total_blocks</span><span class="p">,</span>
    <span class="n">total_bytes</span>       <span class="o">=&gt;</span> <span class="n">l_total_bytes</span><span class="p">,</span>
    <span class="n">unused_blocks</span>     <span class="o">=&gt;</span> <span class="n">l_unused_blocks</span><span class="p">,</span>
    <span class="n">unused_bytes</span>      <span class="o">=&gt;</span> <span class="n">l_unused_bytes</span><span class="p">,</span>
    <span class="n">LAST_USED_EXTENT_FILE_ID</span> <span class="o">=&gt;</span> <span class="n">l_LastUsedExtFileId</span><span class="p">,</span>
    <span class="n">LAST_USED_EXTENT_BLOCK_ID</span> <span class="o">=&gt;</span> <span class="n">l_LastUsedExtBlockId</span><span class="p">,</span>
    <span class="n">LAST_USED_BLOCK</span> <span class="o">=&gt;</span> <span class="n">l_LAST_USED_BLOCK</span> <span class="p">);</span>

    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Total</span> <span class="n">Blocks</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_total_blocks</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Total</span> <span class="n">Bytes</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_total_bytes</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Total</span> <span class="n">MBytes</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">trunc</span><span class="p">(</span><span class="n">l_total_bytes</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Unused</span> <span class="n">Blocks</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_unused_blocks</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Unused</span> <span class="n">Bytes</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_unused_bytes</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Last</span> <span class="n">Used</span> <span class="n">Ext</span> <span class="n">FileId</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_LastUsedExtFileId</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Last</span> <span class="n">Used</span> <span class="n">Ext</span> <span class="n">BlockId</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_LastUsedExtBlockId</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="err">&#39;</span><span class="n">Last</span> <span class="n">Used</span> <span class="n">Block</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">l_LAST_USED_BLOCK</span> <span class="p">);</span>
<span class="n">end</span><span class="p">;</span>
<span class="o">/</span>
<span class="n">set</span> <span class="n">define</span> <span class="n">on</span>
</pre></div>


<h1 id="print_tablesql-by-tom-kyte">print_table.sql by Tom Kyte</h1>
<div class="hlcode"><pre><span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="k">procedure</span> <span class="n">print_table</span><span class="p">(</span> <span class="n">p_query</span> <span class="k">in</span> <span class="n">varchar2</span> <span class="p">)</span>
<span class="n">AUTHID</span> <span class="k">CURRENT_USER</span>
<span class="k">is</span>
    <span class="n">l_theCursor</span>     <span class="nb">integer</span> <span class="k">default</span> <span class="n">dbms_sql</span><span class="p">.</span><span class="n">open_cursor</span><span class="p">;</span>
    <span class="n">l_columnValue</span>   <span class="n">varchar2</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>
    <span class="n">l_status</span>        <span class="nb">integer</span><span class="p">;</span>
    <span class="n">l_descTbl</span>       <span class="n">dbms_sql</span><span class="p">.</span><span class="n">desc_tab</span><span class="p">;</span>
    <span class="n">l_colCnt</span>        <span class="nb">number</span><span class="p">;</span>
<span class="k">begin</span>
    <span class="k">execute</span> <span class="k">immediate</span>
    <span class="s1">&#39;alter session set</span>
<span class="s1">        nls_date_format=&#39;&#39;dd-mon-yyyy hh24:mi:ss&#39;&#39; &#39;</span><span class="p">;</span>

    <span class="n">dbms_sql</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span>  <span class="n">l_theCursor</span><span class="p">,</span>  <span class="n">p_query</span><span class="p">,</span> <span class="n">dbms_sql</span><span class="p">.</span><span class="n">native</span> <span class="p">);</span>
    <span class="n">dbms_sql</span><span class="p">.</span><span class="n">describe_columns</span>
    <span class="p">(</span> <span class="n">l_theCursor</span><span class="p">,</span> <span class="n">l_colCnt</span><span class="p">,</span> <span class="n">l_descTbl</span> <span class="p">);</span>

    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span> <span class="p">..</span> <span class="n">l_colCnt</span> <span class="n">loop</span>
        <span class="n">dbms_sql</span><span class="p">.</span><span class="n">define_column</span>
        <span class="p">(</span><span class="n">l_theCursor</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">l_columnValue</span><span class="p">,</span> <span class="mi">4000</span><span class="p">);</span>
    <span class="k">end</span> <span class="n">loop</span><span class="p">;</span>

    <span class="n">l_status</span> <span class="p">:</span><span class="o">=</span> <span class="n">dbms_sql</span><span class="p">.</span><span class="k">execute</span><span class="p">(</span><span class="n">l_theCursor</span><span class="p">);</span>

    <span class="n">while</span> <span class="p">(</span> <span class="n">dbms_sql</span><span class="p">.</span><span class="n">fetch_rows</span><span class="p">(</span><span class="n">l_theCursor</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">loop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span> <span class="p">..</span> <span class="n">l_colCnt</span> <span class="n">loop</span>
            <span class="n">dbms_sql</span><span class="p">.</span><span class="n">column_value</span>
            <span class="p">(</span> <span class="n">l_theCursor</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">l_columnValue</span> <span class="p">);</span>
            <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span>
            <span class="p">(</span> <span class="n">rpad</span><span class="p">(</span> <span class="n">l_descTbl</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">col_name</span><span class="p">,</span> <span class="mi">30</span> <span class="p">)</span>
              <span class="o">||</span> <span class="s1">&#39;: &#39;</span> <span class="o">||</span>
              <span class="n">l_columnValue</span> <span class="p">);</span>
        <span class="k">end</span> <span class="n">loop</span><span class="p">;</span>
        <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span> <span class="s1">&#39;-----------------&#39;</span> <span class="p">);</span>
    <span class="k">end</span> <span class="n">loop</span><span class="p">;</span>
    <span class="k">execute</span> <span class="k">immediate</span>
        <span class="s1">&#39;alter session set nls_date_format=&#39;&#39;dd-MON-rr&#39;&#39; &#39;</span><span class="p">;</span>
<span class="n">exception</span>
    <span class="k">when</span> <span class="n">others</span> <span class="k">then</span>
      <span class="k">execute</span> <span class="k">immediate</span>
          <span class="s1">&#39;alter session set nls_date_format=&#39;&#39;dd-MON-rr&#39;&#39; &#39;</span><span class="p">;</span>
      <span class="n">raise</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span>
<span class="o">/</span>
</pre></div>


<h1 id="show_spacesql-by-tom-kyte_1">show_space.sql by Tom Kyte</h1>
<div class="hlcode"><pre><span class="c1">-- -----------------------------------------------------------------------------------</span>
<span class="c1">-- Author       : Tom Kyte</span>
<span class="c1">-- Description  : Displays free and unused space for the specified object.</span>
<span class="c1">-- Call Syntax  : EXEC Show_Space(&#39;Tablename&#39;);</span>
<span class="c1">-- Requirements : SET SERVEROUTPUT ON</span>
<span class="c1">-- Last Modified: June 22, 2010</span>
<span class="c1">-- This enhance version has all the fixes for ASSM, LMT, partitions etc (Oracle version 10gr2 +)</span>
<span class="c1">-- -----------------------------------------------------------------------------------</span>

<span class="k">set</span> <span class="n">define</span> <span class="k">off</span>

<span class="k">create</span> <span class="k">or</span> <span class="k">replace</span> <span class="k">procedure</span> <span class="n">show_space</span>
<span class="p">(</span> <span class="n">p_segname</span> <span class="k">in</span> <span class="n">varchar2</span><span class="p">,</span>
  <span class="n">p_owner</span>   <span class="k">in</span> <span class="n">varchar2</span> <span class="k">default</span> <span class="k">user</span><span class="p">,</span>
  <span class="n">p_type</span>    <span class="k">in</span> <span class="n">varchar2</span> <span class="k">default</span> <span class="s1">&#39;TABLE&#39;</span><span class="p">,</span>
  <span class="n">p_partition</span> <span class="k">in</span> <span class="n">varchar2</span> <span class="k">default</span> <span class="k">NULL</span> <span class="p">)</span>
<span class="c1">-- this procedure uses authid current user so it can query DBA_*</span>
<span class="c1">-- views using privileges from a ROLE and so it can be installed</span>
<span class="c1">-- once per database, instead of once per user that wanted to use it authid current_user</span>
<span class="k">as</span>
    <span class="n">l_free_blks</span>                 <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_total_blocks</span>              <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_total_bytes</span>               <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_unused_blocks</span>             <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_unused_bytes</span>              <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_LastUsedExtFileId</span>         <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_LastUsedExtBlockId</span>        <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_LAST_USED_BLOCK</span>           <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_segment_space_mgmt</span>        <span class="n">varchar2</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
    <span class="n">l_unformatted_blocks</span> <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_unformatted_bytes</span> <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_fs1_blocks</span> <span class="nb">number</span><span class="p">;</span> <span class="n">l_fs1_bytes</span> <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_fs2_blocks</span> <span class="nb">number</span><span class="p">;</span> <span class="n">l_fs2_bytes</span> <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_fs3_blocks</span> <span class="nb">number</span><span class="p">;</span> <span class="n">l_fs3_bytes</span> <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_fs4_blocks</span> <span class="nb">number</span><span class="p">;</span> <span class="n">l_fs4_bytes</span> <span class="nb">number</span><span class="p">;</span>
    <span class="n">l_full_blocks</span> <span class="nb">number</span><span class="p">;</span> <span class="n">l_full_bytes</span> <span class="nb">number</span><span class="p">;</span>

    <span class="c1">-- inline procedure to print out numbers nicely formatted</span>
    <span class="c1">-- with a simple label</span>
    <span class="k">procedure</span> <span class="n">p</span><span class="p">(</span> <span class="n">p_label</span> <span class="k">in</span> <span class="n">varchar2</span><span class="p">,</span> <span class="n">p_num</span> <span class="k">in</span> <span class="nb">number</span> <span class="p">)</span>
    <span class="k">is</span>
    <span class="k">begin</span>
        <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span> <span class="n">rpad</span><span class="p">(</span><span class="n">p_label</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">||</span>
                              <span class="n">to_char</span><span class="p">(</span><span class="n">p_num</span><span class="p">,</span><span class="s1">&#39;999,999,999,999&#39;</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">end</span><span class="p">;</span>
<span class="k">begin</span>
   <span class="c1">-- this query is executed dynamically in order to allow this procedure</span>
   <span class="c1">-- to be created by a user who has access to DBA_SEGMENTS/TABLESPACES</span>
   <span class="c1">-- via a role as is customary.</span>
   <span class="c1">-- NOTE: at runtime, the invoker MUST have access to these two</span>
   <span class="c1">-- views!</span>
   <span class="c1">-- this query determines if the object is a ASSM object or not</span>
   <span class="k">begin</span>
      <span class="k">execute</span> <span class="k">immediate</span>
          <span class="s1">&#39;select ts.segment_space_management</span>
<span class="s1">             from dba_segments seg, dba_tablespaces ts</span>
<span class="s1">            where seg.segment_name      = :p_segname</span>
<span class="s1">              and (:p_partition is null or</span>
<span class="s1">                  seg.partition_name = :p_partition)</span>
<span class="s1">              and seg.owner = :p_owner</span>
<span class="s1">              and seg.segment_type = :p_type</span>
<span class="s1">              and seg.tablespace_name = ts.tablespace_name&#39;</span>
             <span class="k">into</span> <span class="n">l_segment_space_mgmt</span>
            <span class="k">using</span> <span class="n">p_segname</span><span class="p">,</span> <span class="n">p_partition</span><span class="p">,</span> <span class="n">p_partition</span><span class="p">,</span> <span class="n">p_owner</span><span class="p">,</span> <span class="n">p_type</span><span class="p">;</span>
   <span class="n">exception</span>
       <span class="k">when</span> <span class="n">too_many_rows</span> <span class="k">then</span>
          <span class="n">dbms_output</span><span class="p">.</span><span class="n">put_line</span>
          <span class="p">(</span> <span class="s1">&#39;This must be a partitioned table, use p_partition =&gt; &#39;</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
   <span class="k">end</span><span class="p">;</span>


   <span class="c1">-- if the object is in an ASSM tablespace, we must use this API</span>
   <span class="c1">-- call to get space information, else we use the FREE_BLOCKS</span>
   <span class="c1">-- API for the user managed segments</span>
   <span class="n">if</span> <span class="n">l_segment_space_mgmt</span> <span class="o">=</span> <span class="s1">&#39;AUTO&#39;</span>
   <span class="k">then</span>
     <span class="n">dbms_space</span><span class="p">.</span><span class="n">space_usage</span>
     <span class="p">(</span> <span class="n">p_owner</span><span class="p">,</span> <span class="n">p_segname</span><span class="p">,</span> <span class="n">p_type</span><span class="p">,</span> <span class="n">l_unformatted_blocks</span><span class="p">,</span>
       <span class="n">l_unformatted_bytes</span><span class="p">,</span> <span class="n">l_fs1_blocks</span><span class="p">,</span> <span class="n">l_fs1_bytes</span><span class="p">,</span>
       <span class="n">l_fs2_blocks</span><span class="p">,</span> <span class="n">l_fs2_bytes</span><span class="p">,</span> <span class="n">l_fs3_blocks</span><span class="p">,</span> <span class="n">l_fs3_bytes</span><span class="p">,</span>
       <span class="n">l_fs4_blocks</span><span class="p">,</span> <span class="n">l_fs4_bytes</span><span class="p">,</span> <span class="n">l_full_blocks</span><span class="p">,</span> <span class="n">l_full_bytes</span><span class="p">,</span> <span class="n">p_partition</span><span class="p">);</span>

     <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Unformatted Blocks &#39;</span><span class="p">,</span> <span class="n">l_unformatted_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;FS1 Blocks (0-25)  &#39;</span><span class="p">,</span> <span class="n">l_fs1_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;FS2 Blocks (25-50) &#39;</span><span class="p">,</span> <span class="n">l_fs2_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;FS3 Blocks (50-75) &#39;</span><span class="p">,</span> <span class="n">l_fs3_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;FS4 Blocks (75-100)&#39;</span><span class="p">,</span> <span class="n">l_fs4_blocks</span> <span class="p">);</span>
     <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Full Blocks        &#39;</span><span class="p">,</span> <span class="n">l_full_blocks</span> <span class="p">);</span>
  <span class="k">else</span>
     <span class="n">dbms_space</span><span class="p">.</span><span class="n">free_blocks</span><span class="p">(</span>
       <span class="n">segment_owner</span>     <span class="o">=&gt;</span> <span class="n">p_owner</span><span class="p">,</span>
       <span class="n">segment_name</span>      <span class="o">=&gt;</span> <span class="n">p_segname</span><span class="p">,</span>
       <span class="n">segment_type</span>      <span class="o">=&gt;</span> <span class="n">p_type</span><span class="p">,</span>
       <span class="n">freelist_group_id</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
       <span class="n">free_blks</span>         <span class="o">=&gt;</span> <span class="n">l_free_blks</span><span class="p">);</span>

     <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Free Blocks&#39;</span><span class="p">,</span> <span class="n">l_free_blks</span> <span class="p">);</span>
  <span class="k">end</span> <span class="n">if</span><span class="p">;</span>

  <span class="c1">-- and then the unused space API call to get the rest of the</span>
  <span class="c1">-- information</span>
  <span class="n">dbms_space</span><span class="p">.</span><span class="n">unused_space</span>
  <span class="p">(</span> <span class="n">segment_owner</span>     <span class="o">=&gt;</span> <span class="n">p_owner</span><span class="p">,</span>
    <span class="n">segment_name</span>      <span class="o">=&gt;</span> <span class="n">p_segname</span><span class="p">,</span>
    <span class="n">segment_type</span>      <span class="o">=&gt;</span> <span class="n">p_type</span><span class="p">,</span>
    <span class="n">partition_name</span>    <span class="o">=&gt;</span> <span class="n">p_partition</span><span class="p">,</span>
    <span class="n">total_blocks</span>      <span class="o">=&gt;</span> <span class="n">l_total_blocks</span><span class="p">,</span>
    <span class="n">total_bytes</span>       <span class="o">=&gt;</span> <span class="n">l_total_bytes</span><span class="p">,</span>
    <span class="n">unused_blocks</span>     <span class="o">=&gt;</span> <span class="n">l_unused_blocks</span><span class="p">,</span>
    <span class="n">unused_bytes</span>      <span class="o">=&gt;</span> <span class="n">l_unused_bytes</span><span class="p">,</span>
    <span class="n">LAST_USED_EXTENT_FILE_ID</span> <span class="o">=&gt;</span> <span class="n">l_LastUsedExtFileId</span><span class="p">,</span>
    <span class="n">LAST_USED_EXTENT_BLOCK_ID</span> <span class="o">=&gt;</span> <span class="n">l_LastUsedExtBlockId</span><span class="p">,</span>
    <span class="n">LAST_USED_BLOCK</span> <span class="o">=&gt;</span> <span class="n">l_LAST_USED_BLOCK</span> <span class="p">);</span>

    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Total Blocks&#39;</span><span class="p">,</span> <span class="n">l_total_blocks</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Total Bytes&#39;</span><span class="p">,</span> <span class="n">l_total_bytes</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Total MBytes&#39;</span><span class="p">,</span> <span class="n">trunc</span><span class="p">(</span><span class="n">l_total_bytes</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Unused Blocks&#39;</span><span class="p">,</span> <span class="n">l_unused_blocks</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Unused Bytes&#39;</span><span class="p">,</span> <span class="n">l_unused_bytes</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Last Used Ext FileId&#39;</span><span class="p">,</span> <span class="n">l_LastUsedExtFileId</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Last Used Ext BlockId&#39;</span><span class="p">,</span> <span class="n">l_LastUsedExtBlockId</span> <span class="p">);</span>
    <span class="n">p</span><span class="p">(</span> <span class="s1">&#39;Last Used Block&#39;</span><span class="p">,</span> <span class="n">l_LAST_USED_BLOCK</span> <span class="p">);</span>
<span class="k">end</span><span class="p">;</span>
<span class="o">/</span>
<span class="k">set</span> <span class="n">define</span> <span class="k">on</span>
</pre></div>


<h1 id="waitprofsql-">waitprof.sql-按等待事件频率分组</h1>
<div class="hlcode"><pre><span class="o">--</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//blog.tanelpoder.com/files/scripts/</span>
<span class="o">--</span>
<span class="o">--</span> <span class="nb">File</span> <span class="nb">name</span><span class="p">:</span>   <span class="nx">waitprof.sql</span> <span class="p">(</span> <span class="nx">Session</span> <span class="nb">Wait</span> <span class="nx">Profiler</span> <span class="p">)</span>
<span class="o">--</span> <span class="nx">Purpose</span><span class="p">:</span>     <span class="nx">Sample</span> <span class="nx">V</span><span class="nv">$SESSION_WAIT</span> <span class="nx">at</span> <span class="nx">high</span> <span class="nx">frequency</span> <span class="ow">and</span> <span class="nx">show</span> <span class="nx">resulting</span> 
<span class="o">--</span>              <span class="nx">session</span> <span class="nb">wait</span> <span class="nx">event</span> <span class="ow">and</span> <span class="nx">parameter</span> <span class="nx">profile</span> <span class="k">by</span> <span class="nx">session</span>
<span class="o">--</span>
<span class="o">--</span> <span class="nx">Author</span><span class="p">:</span>      <span class="nx">Tanel</span> <span class="nx">Poder</span>
<span class="o">--</span> <span class="nx">Copyright</span><span class="p">:</span>   <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//www.tanelpoder.com</span>
<span class="o">--</span>
<span class="o">--</span> <span class="nb">Usage</span><span class="p">:</span>       <span class="p">@</span><span class="nx">waitprof</span> <span class="o">&lt;</span><span class="nx">print</span><span class="o">|</span><span class="nx">noprint</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">sid</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">e</span><span class="err">[</span><span class="mi">123</span><span class="nb">s</span><span class="cp">]</span>&gt; <span class="err">&lt;</span>#samples&gt;
--
--                  <span class="nt">&lt;print</span><span class="err">|</span><span class="na">noprint</span><span class="nt">&gt;</span>
--                              - whether to print P2,P3,SEQ# values or not
--
--                  <span class="nt">&lt;sid&gt;</span>       - session ID of session to sample
--
--                  <span class="err">&lt;</span><span class="cp">[</span><span class="nx">e123s</span><span class="cp">]</span>&gt;   - sample grouping
--                      e - group by event name
--                      1 - group by P1 of v$session_wait event
--                      2 - group by P2
--                      3 - group by P3
--                      s - group by SEQ#
--
--                  <span class="err">&lt;</span>#samples&gt;  - how many samples to take (a modern CPU can take
--                                tens of thousands to low hundreds of k samples
--                                per second)
--
--  Examples:
--              @waitprof noprint 350 e 1000000   -- take million samples, group by event only
--              @waitprof print 350 e123 500000 -- take 500k samples, group by event,p1,p2,p3
--              @waitprof print 350 e3 1000000  -- take million samples, group by event,p3
--              @waitprof print 350 es 1000000  -- take million samples, group by event,seq#
--
--  Other:
--              The sampling relies on NESTED LOOP join method and having
--              V$SESSION_WAIT as the inner (probed) table. Note that on 9i
--              you may need to run this script as SYS as it looks like otherwise
--              the global USE_NL hint is not propagated down to X$ base tables
--
--              If sampling always reports a single distinct event even though 
--              many different events (or parameter values) are expected then 
--              the execution plan used is not right.
--
--------------------------------------------------------------------------------

DEF _swp_print=<span class="err">&amp;</span>1
DEF _swp_sid=<span class="err">&amp;</span>2
DEF _swp_p123=<span class="err">&amp;</span>3
DEF _swp_samples=<span class="err">&amp;</span>4

col sw_event    head EVENT for a35 truncate
col sw_p1transl head P1TRANSL for a42
col sw_sid      head SID for 999999
col swp_p1 head P1 for a26 word_wrap
col swp_p2 head P2 for a16 word_wrap <span class="err">&amp;</span>_swp_print
col swp_p3 head P3 for a16 word_wrap <span class="err">&amp;</span>_swp_print
col swp_seq# head SEQ# <span class="err">&amp;</span>_swp_print
col pct_total_samples head &quot;% Total|Time&quot; format 999.99
col waitprof_total_ms head &quot;Total Event|Time ms&quot; format 9999999.999
col dist_events head Distinct|Events
col average_samples head Average|Samples
col waitprof_avg_ms head &quot;Avg time|ms/Event&quot; format 99999.999

prompt
prompt -- WaitProf 1.04 by Tanel Poder ( http://www.tanelpoder.com )

WITH 
    t1 AS (SELECT hsecs FROM v$timer),
    samples AS (
    SELECT /*+ ORDERED NO_MERGE USE_NL(sw.gv$session_wait.s) */
        s.sid sw_sid,
        CASE WHEN sw.state = &#39;WAITING&#39; THEN &#39;WAITING&#39; ELSE &#39;WORKING&#39; END AS state,
        CASE WHEN sw.state = &#39;WAITING&#39; THEN event ELSE &#39;On CPU / runqueue&#39; END AS sw_event,
        CASE WHEN sw.state = &#39;WAITING&#39; AND &#39;<span class="err">&amp;</span>_swp_p123&#39; LIKE &#39;%1%&#39; THEN sw.p1text || &#39;= &#39; || CASE WHEN (LOWER(sw.p1text) LIKE &#39;%addr%&#39; OR sw.p1 &gt;= 536870912) 
THEN RAWTOHEX(sw.p1raw) ELSE TO_CHAR(sw.p1) END ELSE NULL END swp_p1,
        CASE WHEN sw.state = &#39;WAITING&#39; AND &#39;<span class="err">&amp;</span>_swp_p123&#39; LIKE &#39;%2%&#39; THEN sw.p2text || &#39;= &#39; || CASE WHEN (LOWER(sw.p2text) LIKE &#39;%addr%&#39; OR sw.p2 &gt;= 536870912) 
THEN RAWTOHEX(sw.p2raw) ELSE TO_CHAR(sw.p2) END ELSE NULL END swp_p2,
        CASE WHEN sw.state = &#39;WAITING&#39; AND &#39;<span class="err">&amp;</span>_swp_p123&#39; LIKE &#39;%3%&#39; THEN sw.p3text || &#39;= &#39; || CASE WHEN (LOWER(sw.p3text) LIKE &#39;%addr%&#39; OR sw.p3 &gt;= 536870912) 
THEN RAWTOHEX(sw.p3raw) ELSE TO_CHAR(sw.p3) END ELSE NULL END swp_p3,
        CASE WHEN LOWER(&#39;<span class="err">&amp;</span>_swp_p123&#39;) LIKE &#39;%s%&#39; THEN sw.seq# ELSE NULL END seq#,
        COUNT(*) total_samples,
        COUNT(DISTINCT seq#) dist_events,
        TRUNC(COUNT(*)/COUNT(DISTINCT seq#)) average_samples
    FROM
        (   SELECT /*+ NO_MERGE */ TO_NUMBER(<span class="err">&amp;</span>_swp_sid) sid FROM 
            (SELECT rownum r FROM dual CONNECT BY ROWNUM <span class="err">&lt;</span>= 1000) a,
            (SELECT rownum r FROM dual CONNECT BY ROWNUM <span class="err">&lt;</span>= 1000) b,
            (SELECT rownum r FROM dual CONNECT BY ROWNUM <span class="err">&lt;</span>= 1000) c
           WHERE ROWNUM <span class="err">&lt;</span>= <span class="err">&amp;</span>_swp_samples
        ) s,
        v$session_wait sw
    WHERE
        s.sid = sw.sid
    GROUP BY
        s.sid,
        CASE WHEN sw.state = &#39;WAITING&#39; THEN &#39;WAITING&#39; ELSE &#39;WORKING&#39; END,
        CASE WHEN sw.state = &#39;WAITING&#39; THEN event ELSE &#39;On CPU / runqueue&#39; END,
        CASE WHEN sw.state = &#39;WAITING&#39; AND &#39;<span class="err">&amp;</span>_swp_p123&#39; LIKE &#39;%1%&#39; THEN sw.p1text || &#39;= &#39; || CASE WHEN (LOWER(sw.p1text) LIKE &#39;%addr%&#39; OR sw.p1 &gt;= 536870912) 
THEN RAWTOHEX(sw.p1raw) ELSE TO_CHAR(sw.p1) END ELSE NULL END,
        CASE WHEN sw.state = &#39;WAITING&#39; AND &#39;<span class="err">&amp;</span>_swp_p123&#39; LIKE &#39;%2%&#39; THEN sw.p2text || &#39;= &#39; || CASE WHEN (LOWER(sw.p2text) LIKE &#39;%addr%&#39; OR sw.p2 &gt;= 536870912) 
THEN RAWTOHEX(sw.p2raw) ELSE TO_CHAR(sw.p2) END ELSE NULL END,
        CASE WHEN sw.state = &#39;WAITING&#39; AND &#39;<span class="err">&amp;</span>_swp_p123&#39; LIKE &#39;%3%&#39; THEN sw.p3text || &#39;= &#39; || CASE WHEN (LOWER(sw.p3text) LIKE &#39;%addr%&#39; OR sw.p3 &gt;= 536870912) 
THEN RAWTOHEX(sw.p3raw) ELSE TO_CHAR(sw.p3) END ELSE NULL END,
        CASE WHEN LOWER(&#39;<span class="err">&amp;</span>_swp_p123&#39;) LIKE &#39;%s%&#39; THEN sw.seq# ELSE NULL END
    ORDER BY
        CASE WHEN LOWER(&#39;<span class="err">&amp;</span>_swp_p123&#39;) LIKE &#39;%s%&#39; THEN -seq# ELSE total_samples END DESC
),
    t2 AS (SELECT hsecs FROM v$timer)
SELECT /*+ ORDERED */
    s.sw_sid,
    s.state,
    s.sw_event,
    s.swp_p1,
    s.swp_p2,
    s.swp_p3,
    s.seq# swp_seq#,
    s.total_samples / <span class="err">&amp;</span>_swp_samples * 100 pct_total_samples,
    (t2.hsecs - t1.hsecs) * 10 * s.total_samples / <span class="err">&amp;</span>_swp_samples waitprof_total_ms,
    s.dist_events,
--  s.average_samples,
    (t2.hsecs - t1.hsecs) * 10 * s.total_samples / dist_events / <span class="err">&amp;</span>_swp_samples waitprof_avg_ms
FROM
    t1,
    samples s,
    t2
/

--UNDEF _swp_sid=<span class="err">&amp;</span>1
--UNDEF _swp_p123=<span class="err">&amp;</span>2
--UNDEF _swp_samples=<span class="err">&amp;</span>3
</pre></div>


<h2 id="dba_function-script">dba_function script</h2>
<div class="hlcode"><pre><span class="err">#</span><span class="o">-----------------------------------------------------------</span><span class="err">#</span>
<span class="err">#</span> <span class="nx">show</span> <span class="nx">environment</span> <span class="nx">variables</span> <span class="k">in</span> <span class="nx">sorted</span> <span class="nx">list</span>
  <span class="kd">function</span> <span class="nx">envs</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">z</span> <span class="s2">&quot;$1&quot;</span>
      <span class="nx">then</span> <span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">env</span> <span class="o">|</span> <span class="err">/bin/sort</span>
      <span class="k">else</span> <span class="err">/bin/env | /bin/sort | /bin/grep -i $1</span>
    <span class="nx">fi</span>
  <span class="p">}</span> <span class="err">#</span> <span class="nx">envs</span>
<span class="err">#</span><span class="o">-----------------------------------------------------------</span><span class="err">#</span>
<span class="err">#</span> <span class="nx">login</span> <span class="nx">to</span> <span class="nx">sqlplus</span>
  <span class="kd">function</span> <span class="nx">sp</span> <span class="p">{</span>
    <span class="nx">time</span> <span class="nx">sqlplus</span> <span class="s2">&quot;/ as sysdba&quot;</span>
  <span class="p">}</span> <span class="err">#</span> <span class="nx">sp</span>
<span class="err">#</span><span class="o">-----------------------------------------------------------</span><span class="err">#</span>
<span class="err">#</span> <span class="nx">find</span> <span class="nx">largest</span> <span class="nx">files</span> <span class="nx">below</span> <span class="k">this</span> <span class="nx">point</span>
<span class="kd">function</span> <span class="nx">flf</span> <span class="p">{</span>
  <span class="nx">find</span> <span class="p">.</span> <span class="o">-</span><span class="nx">ls</span> <span class="o">|</span> <span class="nx">sort</span> <span class="o">-</span><span class="nx">nrk7</span> <span class="o">|</span> <span class="nx">head</span> <span class="o">-</span><span class="mi">10</span>
<span class="p">}</span>
<span class="err">#</span><span class="o">-----------------------------------------------------------</span><span class="err">#</span>
<span class="err">#</span> <span class="nx">find</span> <span class="nx">largest</span> <span class="nx">directories</span> <span class="nx">consuming</span> <span class="nx">space</span> <span class="nx">below</span> <span class="k">this</span> <span class="nx">point</span>
<span class="kd">function</span> <span class="nx">fld</span> <span class="p">{</span>
  <span class="nx">du</span> <span class="o">-</span><span class="nx">S</span> <span class="p">.</span> <span class="o">|</span> <span class="nx">sort</span> <span class="o">-</span><span class="nx">nr</span> <span class="o">|</span> <span class="nx">head</span> <span class="o">-</span><span class="mi">10</span>
<span class="p">}</span>
<span class="err">#</span><span class="o">-----------------------------------------------------------</span><span class="err">#</span>
<span class="err">#</span> <span class="nx">cd</span> <span class="nx">to</span> <span class="nx">bdump</span>
  <span class="kd">function</span> <span class="nx">bdump</span> <span class="p">{</span>
   <span class="nx">echo</span> <span class="nx">$ORACLE_HOME</span> <span class="o">|</span> <span class="nx">grep</span> <span class="mi">11</span> <span class="o">&gt;</span><span class="err">/dev/null</span>
   <span class="k">if</span> <span class="cp">[</span> <span class="err">$</span><span class="o">?</span> <span class="na">-eq</span> <span class="mi">0</span> <span class="cp">]</span><span class="p">;</span> <span class="nx">then</span>
     <span class="nx">lower_sid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="nx">echo</span> <span class="nx">$ORACLE_SID</span> <span class="o">|</span> <span class="nx">tr</span> <span class="s1">&#39;</span><span class="cp">[</span><span class="p">:</span><span class="nx">upper</span><span class="p">:</span><span class="cp">]</span><span class="s1">&#39;</span> <span class="s1">&#39;</span><span class="cp">[</span><span class="p">:</span><span class="nx">lower</span><span class="p">:</span><span class="cp">]</span><span class="s1">&#39;</span><span class="p">)</span>
     <span class="nx">cd</span> <span class="nx">$ORACLE_BASE</span><span class="o">/</span><span class="nx">diag</span><span class="o">/</span><span class="nx">rdbms</span><span class="o">/</span><span class="nx">$lower_sid</span><span class="o">/</span><span class="nx">$ORACLE_SID</span><span class="o">/</span><span class="nx">trace</span>
   <span class="k">else</span>
     <span class="nx">cd</span> <span class="nx">$ORACLE_BASE</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">$ORACLE_SID</span><span class="o">/</span><span class="nx">bdump</span>
   <span class="nx">fi</span>
  <span class="p">}</span> <span class="err">#</span> <span class="nx">bdump</span>
<span class="err">#</span><span class="o">-----------------------------------------------------------</span><span class="err">#</span>
<span class="err">#</span> <span class="nx">view</span> <span class="nx">alert</span> <span class="nx">log</span>
  <span class="kd">function</span> <span class="nx">valert</span> <span class="p">{</span>
   <span class="nx">echo</span> <span class="nx">$ORACLE_HOME</span> <span class="o">|</span> <span class="nx">grep</span> <span class="mi">11</span> <span class="o">&gt;</span><span class="err">/dev/null</span>
   <span class="k">if</span> <span class="cp">[</span> <span class="err">$</span><span class="o">?</span> <span class="na">-eq</span> <span class="mi">0</span> <span class="cp">]</span><span class="p">;</span> <span class="nx">then</span>
     <span class="nx">lower_sid</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="nx">echo</span> <span class="nx">$ORACLE_SID</span> <span class="o">|</span> <span class="nx">tr</span> <span class="s1">&#39;</span><span class="cp">[</span><span class="p">:</span><span class="nx">upper</span><span class="p">:</span><span class="cp">]</span><span class="s1">&#39;</span> <span class="s1">&#39;</span><span class="cp">[</span><span class="p">:</span><span class="nx">lower</span><span class="p">:</span><span class="cp">]</span><span class="s1">&#39;</span><span class="p">)</span>
     <span class="nx">view</span> <span class="nx">$ORACLE_BASE</span><span class="o">/</span><span class="nx">diag</span><span class="o">/</span><span class="nx">rdbms</span><span class="o">/</span><span class="nx">$lower_sid</span><span class="o">/</span><span class="nx">$ORACLE_SID</span><span class="o">/</span><span class="nx">trace</span><span class="o">/</span><span class="nx">alert_$ORACLE_SID</span><span class="p">.</span><span class="nx">log</span>
   <span class="k">else</span>
     <span class="nx">view</span> <span class="nx">$ORACLE_BASE</span><span class="o">/</span><span class="nx">admin</span><span class="o">/</span><span class="nx">$ORACLE_SID</span><span class="o">/</span><span class="nx">bdump</span><span class="o">/</span><span class="nx">alert_$ORACLE_SID</span><span class="p">.</span><span class="nx">log</span>
   <span class="nx">fi</span>
  <span class="p">}</span> <span class="err">#</span> <span class="nx">valert</span>
<span class="err">#</span><span class="o">-----------------------------------------------------------</span><span class="err">#</span>

<span class="kr">export</span> <span class="nx">EDITOR</span><span class="o">=</span><span class="nx">vi</span>
<span class="kr">export</span> <span class="nx">VISUAL</span><span class="o">=</span><span class="nx">$EDITOR</span>
<span class="kr">export</span> <span class="nx">SQLPATH</span><span class="o">=</span><span class="nx">$HOME</span><span class="o">/</span><span class="nx">scripts</span>
<span class="nx">set</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">vi</span>
<span class="err">#</span>
<span class="err">#</span> <span class="nx">list</span> <span class="nx">directories</span> <span class="nx">only</span>
<span class="nx">alias</span> <span class="nx">lsd</span><span class="o">=</span><span class="s2">&quot;ls -p | grep /&quot;</span>
<span class="err">#</span> <span class="nx">show</span> <span class="nx">top</span> <span class="nx">cpu</span> <span class="nx">consuming</span> <span class="nx">processes</span>
<span class="nx">alias</span> <span class="nx">topc</span><span class="o">=</span><span class="s2">&quot;ps -e -o pcpu,pid,user,tty,args | sort -n -k 1 -r | head&quot;</span>
<span class="err">#</span> <span class="nx">show</span> <span class="nx">top</span> <span class="nx">memory</span> <span class="nx">consuming</span> <span class="nx">processes</span>
<span class="nx">alias</span> <span class="nx">topm</span><span class="o">=</span><span class="s2">&quot;ps -e -o pmem,pid,user,tty,args | sort -n -k 1 -r | head&quot;</span>
<span class="err">#</span>
<span class="nx">alias</span> <span class="nx">sqlp</span><span class="o">=</span><span class="s1">&#39;sqlplus &quot;/ as sysdba&quot;&#39;</span>
<span class="nx">alias</span> <span class="nx">shutdb</span><span class="o">=</span><span class="s1">&#39;echo &quot;shutdown immediate;&quot; | sqlp&#39;</span>
<span class="nx">alias</span> <span class="nx">startdb</span><span class="o">=</span><span class="s1">&#39;echo &quot;startup;&quot; | sqlp&#39;</span>
</pre></div>
  
</div>
    </div>
    <div id="footer">
      <!-- <div class="footer-left"> -->
      <!-- <div class="footer-center"> -->
        <center>
        <p>
        Copyright © 2012-2018 Fung Kong.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
        </center>
      <!-- </div> [> end footer-left <] -->
      <!-- <div class="footer-right"> -->
        <!-- <p>站点最后生成 2018-03-15 10:45:50</p> -->
      <!-- </div> [> end footer-right <] -->
    </div>

    
    

  </body>
</html>